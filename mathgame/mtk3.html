<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Stickman Math Runner PRO</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}

body{
 background:#0f172a;
 display:flex;
 justify-content:center;
 align-items:center;
 height:100vh;
 color:white;
}

.card{
 width:1100px;
 background:#111827;
 border-radius:24px;
 box-shadow:0 30px 80px #000;
 overflow:hidden;
}

header{
 text-align:center;
 padding:18px;
 font-weight:800;
 font-size:22px;
 background:#0b1220;
 letter-spacing:1px;
}

.stats{
 display:grid;
 grid-template-columns:repeat(6,1fr);
 background:#0b1220;
}

.stat{
 text-align:center;
 padding:12px;
 border-right:1px solid #1f2937;
}

canvas{
 background:linear-gradient(#1e293b,#0f172a);
 display:block;
 margin:auto;
 border-radius:18px;
}

#gameArea{
 padding:20px;
 text-align:center;
}

.question{
 font-size:32px;
 margin:10px 0;
 font-weight:700;
}

.answers{
 display:grid;
 grid-template-columns:repeat(2,1fr);
 gap:10px;
}

.btn{
 padding:16px;
 font-size:22px;
 border:none;
 border-radius:12px;
 background:#1f2937;
 color:white;
 cursor:pointer;
}

.btn:hover{background:#6366f1}

.correct{background:#10b981}
.wrong{background:#ef4444}

.menu{
 padding:60px;
}

.skinBtn{
 margin:5px;
 padding:10px 16px;
 background:#374151;
 border:none;
 color:white;
 border-radius:10px;
 cursor:pointer;
}

.startBtn{
 margin-top:20px;
 padding:14px 40px;
 font-size:18px;
 background:#6366f1;
 border:none;
 border-radius:14px;
 color:white;
 cursor:pointer;
}

.bossbar{
 height:12px;
 background:#1f2937;
 margin:10px 0;
 border-radius:8px;
 overflow:hidden;
}

.bossfill{
 height:100%;
 background:#ef4444;
 width:100%;
}
</style>
</head>

<body>

<div class="card">
<header>âš¡ Stickman Math Runner PRO</header>

<div class="stats">
<div class="stat">Score <span id="score">0</span></div>
<div class="stat">Life <span id="life">3</span></div>
<div class="stat">Level <span id="level">1</span></div>
<div class="stat">Combo <span id="combo">0</span></div>
<div class="stat">High <span id="high">0</span></div>
<div class="stat">Skin <span id="skinName">Default</span></div>
</div>

<div id="gameArea"></div>
</div>

<script>
/* ===============================
   SIMPLE AUDIO ENGINE
================================*/
const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function beep(freq,d=0.1){
 const o=audioCtx.createOscillator();
 const g=audioCtx.createGain();
 o.frequency.value=freq;
 o.connect(g); g.connect(audioCtx.destination);
 o.start();
 g.gain.exponentialRampToValueAtTime(0.0001,audioCtx.currentTime+d);
}

/* ===============================
   STATE
================================*/
const s={
 score:0,life:3,level:1,combo:0,
 high:localStorage.getItem("hi")||0,
 skin:"default",
 boss:false,bossHP:10
};

high.textContent=s.high;

/* ===============================
   MENU
================================*/
function menu(){
 gameArea.innerHTML=`
 <div class="menu">
   <h2>Pilih Skin</h2>
   <button class="skinBtn" onclick="setSkin('default')">ðŸ™‚ Default</button>
   <button class="skinBtn" onclick="setSkin('ninja')">ðŸ¥· Ninja</button>
   <button class="skinBtn" onclick="setSkin('robot')">ðŸ¤– Robot</button>
   <br>
   <button class="startBtn" onclick="start()">START GAME</button>
 </div>`;
}
menu();

function setSkin(x){
 s.skin=x;
 skinName.textContent=x;
}

/* ===============================
   START
================================*/
let canvas,ctx,loopId;
let stick={x:150,y:260,vy:0,jump:false};
let obstacles=[];

function start(){
 s.score=0;s.life=3;s.level=1;s.combo=0;
 render();
}

function render(){
 s.boss = (s.level%5===0);
 if(s.boss) s.bossHP=10+s.level*2;

 gameArea.innerHTML=`
 <canvas id="cv" width="900" height="350"></canvas>
 ${s.boss?`<div class="bossbar"><div class="bossfill" id="bossfill"></div></div>`:""}
 <div class="question" id="q"></div>
 <div class="answers" id="ans"></div>
 `;

 canvas=cv;
 ctx=canvas.getContext("2d");

 newQuestion();
 loop();
}

/* ===============================
   QUESTION
================================*/
function newQuestion(){
 let a=Math.floor(Math.random()*10*s.level)+1;
 let b=Math.floor(Math.random()*10)+1;
 let ans=a+b;

 q.textContent=`${a}+${b}=?`;

 let arr=[ans];
 while(arr.length<4){
  let n=ans+Math.floor(Math.random()*10)-5;
  if(!arr.includes(n)&&n>0)arr.push(n);
 }
 arr.sort(()=>Math.random()-0.5);

 ans.innerHTML="";
 arr.forEach((v,i)=>{
   const b=document.createElement("button");
   b.className="btn";
   b.innerText=v;
   b.onclick=()=>check(v);
   ans.appendChild(b);
 });
}

/* ===============================
   GAME LOOP
================================*/
function loop(){
 ctx.clearRect(0,0,900,350);

 ctx.fillStyle="#334155";
 ctx.fillRect(0,300,900,50);

 if(Math.random()<0.02) obstacles.push({x:900});

 obstacles.forEach(o=>{
  o.x-=6;
  ctx.fillStyle="#ef4444";
  ctx.fillRect(o.x,280,20,20);

  if(o.x<170 && o.x>130 && !stick.jump){
   hit();
  }
 });

 obstacles=obstacles.filter(o=>o.x>-20);

 if(stick.jump){
  stick.vy+=0.8;
  stick.y+=stick.vy;
  if(stick.y>=260){stick.y=260;stick.jump=false;}
 }

 drawStick();

 loopId=requestAnimationFrame(loop);
}

function drawStick(){
 ctx.font="30px serif";
 let emoji="ðŸ™‚";
 if(s.skin==="ninja")emoji="ðŸ¥·";
 if(s.skin==="robot")emoji="ðŸ¤–";
 ctx.fillText(emoji,140,stick.y);
}

/* ===============================
   LOGIC
================================*/
function jump(){
 if(!stick.jump){
  stick.jump=true;
  stick.vy=-14;
  beep(600);
 }
}

function hit(){
 s.life--;
 s.combo=0;
 beep(200);
 update();
 if(s.life<=0) gameOver();
}

function check(v){
 const ans=parseInt(q.textContent.split('+')[0]) + parseInt(q.textContent.split('+')[1]);
 if(v===ans){
  s.combo++;
  s.score+=100*(1+s.combo*0.2);
  beep(900);

  if(s.boss){
   s.bossHP--;
   bossfill.style.width=(s.bossHP/20*100)+"%";
   if(s.bossHP<=0){s.level++; render();}
  }else{
   s.level+=0.2;
   jump();
   newQuestion();
  }

 }else hit();

 update();
}

function update(){
 score.textContent=Math.floor(s.score);
 life.textContent=s.life;
 level.textContent=Math.floor(s.level);
 combo.textContent=s.combo;
}

/* ===============================
   GAME OVER
================================*/
function gameOver(){
 cancelAnimationFrame(loopId);
 if(s.score>s.high){
  localStorage.setItem("hi",Math.floor(s.score));
 }
 menu();
}

/* ===============================
   KEYBOARD
================================*/
document.addEventListener("keydown",e=>{
 if(e.code==="Space") jump();
 if(["1","2","3","4"].includes(e.key)){
  document.querySelectorAll(".btn")[e.key-1]?.click();
 }
});
</script>
</body>
</html>
