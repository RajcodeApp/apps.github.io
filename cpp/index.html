<!DOCTYPE html>
<html lang="id" data-theme="auto">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Algonova Calculator MAX EDITION | Professional Suite v4.0</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366F1"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQWxnb25vdmEgQ2FsY3VsYXRvciBNQVgiLCJzaG9ydF9uYW1lIjoiQWxnb25vdmEiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJ0aGVtZV9jb2xvciI6IiM2MzY2RjEiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzBBMEUxQSJ9"/>
    
    <!-- Enhanced CDN Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.basic.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Manrope:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* ========== ENHANCED CSS VARIABLES ========== */
        :root {
            /* Core Colors */
            --primary-50: #EEF2FF; --primary-100: #E0E7FF; --primary-200: #C7D2FE;
            --primary-300: #A5B4FC; --primary-400: #818CF8; --primary-500: #6366F1;
            --primary-600: #4F46E5; --primary-700: #4338CA; --primary-800: #3730A3;
            --primary-900: #312E81; --primary-950: #1E1B4B;
            
            --secondary-50: #FAF5FF; --secondary-100: #F3E8FF; --secondary-200: #E9D5FF;
            --secondary-300: #D8B4FE; --secondary-400: #C084FC; --secondary-500: #A855F7;
            --secondary-600: #9333EA; --secondary-700: #7C3AED; --secondary-800: #6B21A8;
            --secondary-900: #581C87; --secondary-950: #3B0764;
            
            /* Theme Variables */
            --bg-primary: #0A0E1A; --bg-secondary: #151B2E; --bg-tertiary: #1F2937;
            --bg-elevated: #374151; --bg-glass: rgba(21, 27, 46, 0.8);
            --text-primary: #F8FAFC; --text-secondary: #CBD5E1; --text-tertiary: #94A3B8;
            --border-primary: #374151; --border-secondary: #4B5563;
            
            /* Semantic Colors */
            --success: #10B981; --warning: #F59E0B; --error: #EF4444; --info: #3B82F6;
            --success-bg: rgba(16, 185, 129, 0.1); --warning-bg: rgba(245, 158, 11, 0.1);
            --error-bg: rgba(239, 68, 68, 0.1); --info-bg: rgba(59, 130, 246, 0.1);
            
            /* Shadows & Effects */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.4);
            
            /* Transitions */
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Spacing */
            --space-xs: 0.25rem; --space-sm: 0.5rem; --space-md: 0.75rem;
            --space-lg: 1rem; --space-xl: 1.5rem; --space-2xl: 2rem;
            
            /* Radius */
            --radius-sm: 6px; --radius-md: 10px; --radius-lg: 14px; --radius-xl: 18px;
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-display: 'Manrope', sans-serif; --font-mono: 'JetBrains Mono', monospace;
        }
        
        /* Light Theme */
        [data-theme="light"] {
            --bg-primary: #F8FAFC; --bg-secondary: #FFFFFF; --bg-tertiary: #F1F5F9;
            --bg-elevated: #E2E8F0; --bg-glass: rgba(255, 255, 255, 0.9);
            --text-primary: #0F172A; --text-secondary: #475569; --text-tertiary: #64748B;
            --border-primary: #E2E8F0; --border-secondary: #CBD5E1;
        }
        
        /* Auto Theme Detection */
        @media (prefers-color-scheme: light) {
            [data-theme="auto"] {
                --bg-primary: #F8FAFC; --bg-secondary: #FFFFFF; --bg-tertiary: #F1F5F9;
                --bg-elevated: #E2E8F0; --bg-glass: rgba(255, 255, 255, 0.9);
                --text-primary: #0F172A; --text-secondary: #475569; --text-tertiary: #64748B;
                --border-primary: #E2E8F0; --border-secondary: #CBD5E1;
            }
        }
        
        /* ========== ENHANCED BASE STYLES ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: var(--font-sans); background: var(--bg-primary); color: var(--text-primary);
            line-height: 1.6; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden; min-height: 100vh; font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
        }
        
        /* ========== ADVANCED ANIMATED BACKGROUND ========== */
        .animated-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden;
            background: radial-gradient(ellipse 800px 600px at 50% 0%, var(--primary-950), transparent 50%),
                       radial-gradient(ellipse 600px 400px at 0% 100%, var(--secondary-950), transparent 50%),
                       radial-gradient(ellipse 800px 600px at 100% 100%, var(--primary-900), transparent 50%);
        }
        
        .floating-shapes {
            position: absolute; width: 100%; height: 100%; overflow: hidden;
        }
        
        .shape {
            position: absolute; background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            border-radius: 50%; filter: blur(60px); opacity: 0.1;
            animation: float var(--duration, 20s) ease-in-out infinite;
            animation-delay: var(--delay, 0s);
        }
        
        .shape:nth-child(1) { width: 400px; height: 400px; top: 10%; left: 10%; --duration: 25s; --delay: 0s; }
        .shape:nth-child(2) { width: 300px; height: 300px; top: 60%; right: 10%; --duration: 20s; --delay: 5s; }
        .shape:nth-child(3) { width: 500px; height: 500px; bottom: 10%; left: 50%; --duration: 30s; --delay: 10s; }
        .shape:nth-child(4) { width: 200px; height: 200px; top: 30%; right: 40%; --duration: 15s; --delay: 7s; }
        .shape:nth-child(5) { width: 600px; height: 600px; bottom: 30%; right: 30%; --duration: 35s; --delay: 12s; }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg) scale(1); }
            25% { transform: translate(30px, -30px) rotate(90deg) scale(1.1); }
            50% { transform: translate(-20px, 20px) rotate(180deg) scale(0.9); }
            75% { transform: translate(-30px, -10px) rotate(270deg) scale(1.05); }
        }
        
        /* ========== GLASS MORPHISM COMPONENTS ========== */
        .glass {
            background: var(--bg-glass); backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid var(--border-primary); box-shadow: var(--shadow-lg);
        }
        
        .glass-intense {
            background: rgba(21, 27, 46, 0.95); backdrop-filter: blur(30px) saturate(200%);
            border: 1px solid var(--border-secondary); box-shadow: var(--shadow-xl);
        }
        
        /* ========== ADVANCED CARD SYSTEM ========== */
        .card {
            background: var(--bg-glass); backdrop-filter: blur(25px) saturate(180%);
            border-radius: var(--radius-xl); border: 1px solid var(--border-primary);
            transition: all var(--transition-normal); position: relative; overflow: hidden;
            box-shadow: var(--shadow-lg);
        }
        
        .card::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left var(--transition-slow); z-index: 1;
        }
        
        .card:hover {
            border-color: var(--primary-500); transform: translateY(-2px) scale(1.01);
            box-shadow: var(--shadow-glow);
        }
        
        .card:hover::before { left: 100%; }
        
        .card-premium {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 2px solid var(--primary-500); box-shadow: var(--shadow-glow);
        }
        
        .card-premium::after {
            content: '‚ú®'; position: absolute; top: 1rem; right: 1rem;
            font-size: 1.25rem; opacity: 0.7; animation: sparkle 2s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.7; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
        }
        
        /* ========== ENHANCED INPUT SYSTEM ========== */
        .input-wrapper {
            position: relative; margin-bottom: var(--space-lg);
        }
        
        .input-field {
            width: 100%; padding: 1rem 1.25rem; font-size: 0.875rem; font-weight: 500;
            color: var(--text-primary); background: var(--bg-secondary);
            border: 2px solid var(--border-primary); border-radius: var(--radius-lg);
            transition: all var(--transition-normal); outline: none; position: relative;
        }
        
        .input-field:focus {
            border-color: var(--primary-500); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            transform: translateY(-1px); background: var(--bg-tertiary);
        }
        
        .input-label {
            position: absolute; left: 1.25rem; top: 1rem; font-size: 0.875rem; font-weight: 600;
            color: var(--text-tertiary); pointer-events: none; transition: all var(--transition-normal);
            background: var(--bg-secondary); padding: 0 0.5rem; border-radius: var(--radius-sm);
        }
        
        .input-field:focus + .input-label,
        .input-field:not(:placeholder-shown) + .input-label {
            top: -0.5rem; left: 1rem; font-size: 0.75rem; color: var(--primary-500);
        }
        
        /* ========== ADVANCED BUTTON SYSTEM ========== */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: var(--space-sm);
            padding: 0.875rem 1.5rem; font-size: 0.875rem; font-weight: 600; border-radius: var(--radius-lg);
            border: none; cursor: pointer; transition: all var(--transition-normal); outline: none;
            position: relative; overflow: hidden; text-decoration: none; white-space: nowrap;
        }
        
        .btn::before {
            content: ''; position: absolute; inset: 0; background: rgba(255,255,255,0.1);
            transform: translateX(-100%) skewX(-15deg); transition: transform var(--transition-slow);
        }
        
        .btn:hover::before { transform: translateX(100%) skewX(-15deg); }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white; box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
            transform: translateY(-1px); box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary); color: var(--text-primary);
            border: 2px solid var(--border-secondary); box-shadow: var(--shadow-sm);
        }
        
        .btn-secondary:hover {
            background: var(--bg-elevated); border-color: var(--primary-500);
            transform: translateY(-1px); box-shadow: var(--shadow-md);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #D97706);
            color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--error), #DC2626);
            color: white; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        /* ========== FLOATING ACTION BUTTONS ========== */
        .fab-container {
            position: fixed; bottom: 2rem; right: 2rem; z-index: 100;
            display: flex; flex-direction: column; gap: var(--space-lg);
        }
        
        .fab {
            width: 64px; height: 64px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            color: white; display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: var(--shadow-glow); transition: all var(--transition-normal);
            border: none; position: relative; overflow: hidden;
        }
        
        .fab::before {
            content: ''; position: absolute; inset: 0; border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.3), transparent);
            transform: scale(0); transition: transform var(--transition-normal);
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(8deg); box-shadow: 0 20px 40px rgba(99, 102, 241, 0.5);
        }
        
        .fab:hover::before { transform: scale(1); }
        
        .fab:active { transform: scale(0.95); }
        
        /* ========== THEME TOGGLE ========== */
        .theme-toggle {
            width: 80px; height: 40px; background: var(--bg-tertiary); border-radius: 20px;
            border: 2px solid var(--border-primary); position: relative; cursor: pointer;
            transition: all var(--transition-normal); overflow: hidden;
        }
        
        .theme-toggle::before {
            content: ''; position: absolute; inset: 2px; background: var(--bg-primary);
            border-radius: 18px; transition: all var(--transition-normal);
        }
        
        .theme-toggle-ball {
            width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            border-radius: 50%; position: absolute; top: 2px; left: 2px; z-index: 2;
            transition: all var(--transition-slow); display: flex; align-items: center;
            justify-content: center; color: white; font-size: 0.875rem; box-shadow: var(--shadow-md);
        }
        
        [data-theme="light"] .theme-toggle-ball { left: 44px; }
        [data-theme="auto"] .theme-toggle-ball { left: 23px; background: linear-gradient(135deg, var(--warning), var(--info)); }
        
        /* ========== ENHANCED MODALS ========== */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(10, 14, 26, 0.95); backdrop-filter: blur(20px);
            display: flex; align-items: center; justify-content: center; z-index: 1000;
            animation: modalFadeIn 0.3s ease; padding: 2rem;
        }
        
        .modal-content {
            background: var(--bg-glass); border: 1px solid var(--border-secondary);
            border-radius: var(--radius-xl); max-width: 95vw; max-height: 90vh; overflow: hidden;
            animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-xl); backdrop-filter: blur(30px);
        }
        
        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalSlideUp {
            from { transform: translateY(30px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        /* ========== TOAST NOTIFICATIONS ========== */
        .toast {
            position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(100px);
            background: var(--bg-glass); color: var(--text-primary); padding: 1.25rem 2rem;
            border-radius: var(--radius-xl); border: 1px solid var(--border-secondary);
            box-shadow: var(--shadow-xl); z-index: 2000; display: flex; align-items: center; gap: var(--space-lg);
            transition: all var(--transition-slow); min-width: 320px; backdrop-filter: blur(20px);
        }
        
        .toast.show { transform: translateX(-50%) translateY(0); }
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--error); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.info { border-left: 4px solid var(--info); }
        
        /* ========== ADVANCED LOADING STATES ========== */
        .loading-skeleton {
            background: linear-gradient(90deg, var(--bg-tertiary), var(--bg-elevated), var(--bg-tertiary));
            background-size: 200% 100%; animation: skeleton 1.5s ease-in-out infinite;
        }
        
        @keyframes skeleton {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .spinner {
            width: 40px; height: 40px; border: 3px solid var(--border-primary);
            border-top: 3px solid var(--primary-500); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* ========== ADVANCED SCROLLBAR ========== */
        ::-webkit-scrollbar { width: 12px; height: 12px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 6px; }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-500), var(--secondary-500));
            border-radius: 6px; border: 2px solid var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg, var(--primary-600), var(--secondary-600)); }
        
        /* ========== UTILITIES ========== */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: var(--space-sm); }
        .gap-3 { gap: var(--space-md); }
        .gap-4 { gap: var(--space-lg); }
        .mb-4 { margin-bottom: var(--space-lg); }
        .p-4 { padding: var(--space-lg); }
        .text-center { text-align: center; }
        .font-mono { font-family: var(--font-mono); }
        .font-display { font-family: var(--font-display); }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-extrabold { font-weight: 800; }
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-tertiary { color: var(--text-tertiary); }
        .bg-primary { background: var(--bg-primary); }
        .bg-secondary { background: var(--bg-secondary); }
        .bg-tertiary { background: var(--bg-tertiary); }
        .border { border: 1px solid var(--border-primary); }
        .rounded { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .shadow { box-shadow: var(--shadow-md); }
        .hidden { display: none; }
        .opacity-50 { opacity: 0.5; }
        .opacity-75 { opacity: 0.75; }
        .transition { transition: all var(--transition-normal); }
        
        /* ========== RESPONSIVE DESIGN ========== */
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        
        @media (max-width: 768px) {
            .grid-cols-2 { grid-template-columns: 1fr; }
            .grid-cols-3 { grid-template-columns: 1fr; }
            .fab-container { bottom: 1rem; right: 1rem; }
            .fab { width: 56px; height: 56px; }
        }
        
        /* ========== ANIMATIONS ========== */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .animate-fadeInUp { animation: fadeInUp 0.5s ease; }
        .animate-fadeInScale { animation: fadeInScale 0.3s ease; }
        
        /* ========== PERFORMANCE OPTIMIZATIONS ========== */
        .gpu-accelerated {
            transform: translateZ(0); backface-visibility: hidden; perspective: 1000;
        }
        
        .will-change-transform { will-change: transform; }
        .will-change-opacity { will-change: opacity; }
    </style>
</head>

<body class="bg-primary">
    <!-- Enhanced Animated Background -->
    <div class="animated-background">
        <div class="floating-shapes">
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
            <div class="shape"></div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Enhanced Header -->
        <header class="glass-intense sticky top-0 z-50 border-b border-border-secondary">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <!-- Logo & Brand -->
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <div class="w-14 h-14 bg-gradient-to-br from-primary-500 to-secondary-500 rounded-2xl flex items-center justify-center shadow-glow">
                                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                            <div class="absolute -top-1 -right-1 w-6 h-6 bg-gradient-to-r from-warning to-error rounded-full flex items-center justify-center text-white text-xs font-bold animate-pulse">
                                MAX
                            </div>
                        </div>
                        <div>
                            <h1 class="font-display text-2xl font-extrabold text-primary leading-tight">
                                Algonova Calculator
                                <span class="text-lg bg-gradient-to-r from-warning to-error bg-clip-text text-transparent font-black">MAX EDITION</span>
                            </h1>
                            <div class="flex items-center gap-3 mt-1">
                                <span class="px-2 py-1 bg-gradient-to-r from-secondary-500 to-primary-500 text-white text-xs font-bold rounded-lg">
                                    üöÄ Professional Suite v4.0
                                </span>
                                <span class="text-xs text-tertiary">By Mi Raj & Team 8</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Header Stats & Controls -->
                    <div class="flex items-center gap-6">
                        <!-- Quick Stats -->
                        <div class="text-right hidden md:block">
                            <div class="text-xs font-bold text-tertiary uppercase tracking-wider">Total Investment</div>
                            <div id="headerTotal" class="font-display text-2xl font-black bg-gradient-to-r from-primary-500 to-secondary-500 bg-clip-text text-transparent">
                                Rp 0
                            </div>
                            <div class="text-xs text-secondary mt-1">
                                <span id="headerLessons">0</span> lessons ‚Ä¢ 
                                <span id="headerPackages">0</span> packages
                            </div>
                        </div>
                        
                        <!-- Advanced Theme Toggle -->
                        <div class="theme-toggle" onclick="cycleTheme()" title="Cycle Theme: Dark ‚Üí Light ‚Üí Auto">
                            <div class="theme-toggle-ball">üåô</div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="flex items-center gap-2">
                            <button class="btn btn-secondary p-3" onclick="toggleQuickMenu()" title="Quick Menu">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 max-w-7xl mx-auto w-full px-6 py-8">
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                <!-- Left Column: Package Builder -->
                <div class="xl:col-span-2 space-y-6">
                    <!-- Package Builder Header -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h2 class="font-display text-xl font-bold text-primary">üì¶ Package Builder</h2>
                                <p class="text-sm text-secondary mt-1">Build your custom learning packages</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <button class="btn btn-secondary" onclick="addPackage()">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    Add Package
                                </button>
                                <button class="btn btn-warning" onclick="resetAllPackages()">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    Reset All
                                </button>
                            </div>
                        </div>
                        
                        <!-- AI Search Bar -->
                        <div class="relative">
                            <input type="text" id="aiSearch" placeholder="ü§ñ Type to search courses with AI..." 
                                   class="w-full pl-12 pr-4 py-3 bg-secondary border-2 border-border-primary rounded-lg text-primary placeholder-tertiary focus:border-primary-500 focus:outline-none transition">
                            <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Packages Grid -->
                    <div id="packagesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Packages will be dynamically generated -->
                    </div>
                </div>
                
                <!-- Right Column: Analytics & Controls -->
                <div class="space-y-6">
                    <!-- Investment Summary -->
                    <div class="card-premium p-6 relative overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-br from-primary-500/10 to-secondary-500/10"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <div class="text-xs font-bold text-primary-400 uppercase tracking-wider mb-2">Investment Summary</div>
                                    <div id="totalInvestment" class="font-display text-3xl font-black text-primary">Rp 0</div>
                                    <div class="text-sm text-secondary mt-1">
                                        <span id="totalLessonsDetail">0</span> Total Lessons
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs font-bold text-success uppercase tracking-wider mb-2">Savings</div>
                                    <div id="totalSavings" class="font-display text-xl font-bold text-success">Rp 0</div>
                                    <div id="savingsPercentage" class="text-sm text-success/80 mt-1">0%</div>
                                </div>
                            </div>
                            
                            <!-- Advanced Stats Grid -->
                            <div class="grid grid-cols-2 gap-4 mt-6">
                                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
                                    <div id="avgPricePerLesson" class="font-display text-lg font-bold text-white">Rp 0</div>
                                    <div class="text-xs text-white/70 mt-1">Avg / Lesson</div>
                                </div>
                                <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20">
                                    <div id="activePackagesCount" class="font-display text-lg font-bold text-white">0</div>
                                    <div class="text-xs text-white/70 mt-1">Active Packages</div>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="grid grid-cols-2 gap-3 mt-6">
                                <button class="btn btn-success" onclick="generateInvoice()">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    Invoice
                                </button>
                                <button class="btn btn-secondary" onclick="exportData()">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    Export
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Student Profile -->
                    <div class="card p-6">
                        <h3 class="font-display text-lg font-bold text-primary mb-4">üë§ Student Profile</h3>
                        <div class="space-y-4">
                            <div class="input-wrapper">
                                <input type="number" id="studentAge" class="input-field" min="5" max="17" placeholder=" ">
                                <label class="input-label">Student Age (5-17 years)</label>
                            </div>
                            <div class="input-wrapper">
                                <input type="text" id="studentName" class="input-field" placeholder=" ">
                                <label class="input-label">Student Name</label>
                            </div>
                            <div class="input-wrapper">
                                <select id="experienceLevel" class="input-field">
                                    <option value="">Select experience level</option>
                                    <option value="beginner">üå± Complete Beginner</option>
                                    <option value="some">üåø Some Experience</option>
                                    <option value="intermediate">üå≥ Intermediate</option>
                                    <option value="advanced">üöÄ Advanced</option>
                                </select>
                                <label class="input-label">Coding Experience</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Analytics -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-display text-lg font-bold text-primary">üìä Advanced Analytics</h3>
                            <button class="btn btn-secondary p-2" onclick="toggleChartType()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="h-64 relative">
                            <canvas id="advancedChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- AI Recommendations -->
                    <div class="card p-6">
                        <h3 class="font-display text-lg font-bold text-primary mb-4">ü§ñ AI Smart Recommendations</h3>
                        <div id="aiRecommendations" class="space-y-3">
                            <div class="text-center py-8 text-tertiary">
                                <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                </svg>
                                <p class="text-sm">Enter student details for AI-powered recommendations</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Templates -->
                    <div class="card p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-display text-lg font-bold text-primary">‚ö° Quick Templates</h3>
                            <button class="btn btn-secondary p-2" onclick="manageTemplates()">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                                </svg>
                            </button>
                        </div>
                        <div id="quickTemplates" class="space-y-2">
                            <!-- Templates will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Enhanced FAB Menu -->
    <div class="fab-container">
        <button class="fab" onclick="openAdvancedExport()" title="Advanced Export">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
        </button>
        
        <button class="fab" onclick="openComparisonSuite()" title="Comparison Suite">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2-2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
        </button>
        
        <button class="fab" onclick="openCalculationHistory()" title="Calculation History">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
        </button>
        
        <button class="fab" onclick="saveCalculation()" title="Save Calculation">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
            </svg>
        </button>
        
        <button class="fab" onclick="shareCalculation()" title="Share Calculation">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
            </svg>
        </button>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-3">
        <!-- Toasts will be dynamically added here -->
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-primary/95 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-primary font-semibold">Processing...</p>
        </div>
    </div>

    <script>
        // ========== ADVANCED JAVASCRIPT ARCHITECTURE ==========
        
        class AlgonovaCalculatorMax {
            constructor() {
                this.state = {
                    packages: new Map(),
                    total: 0,
                    lessons: 0,
                    savings: 0,
                    theme: 'auto',
                    chartType: 'bar',
                    recommendations: []
                };
                
                this.priceData = {
                    group: {
                        np: { 10: { normal: 1890000, extra: 1701000 }, 20: { normal: 3580000, extra: 3222000 }, 40: { normal: 6760000, extra: 6084000 }, 80: { normal: 12720000, extra: 11448000 }, 120: { normal: 16680000, extra: 15012000 } },
                        nd: { 10: { normal: 1590000, extra: 1431000 }, 20: { normal: 2980000, extra: 2681000 }, 40: { normal: 5560000, extra: 5004000 }, 80: { normal: 10320000, extra: 9288000 }, 120: { normal: 14280000, extra: 12852000 } },
                        tcp: { 10: { normal: 1390000, extra: 1251000 }, 20: { normal: 2580000, extra: 2322000 }, 40: { normal: 4760000, extra: 4284000 }, 80: { normal: 8720000, extra: 7848000 }, 120: { normal: 11880000, extra: 10692000 } },
                        kop: { 10: { normal: 1350000, extra: 1215000 }, 20: { normal: 2500000, extra: 2250000 }, 40: { normal: 4240000, extra: 4176000 }, 80: { normal: 6960000, extra: 7632000 }, 120: { normal: 9240000, extra: 10476000 } }
                    },
                    private: {
                        np: { 10: { normal: 3900000, extra: 3510000 }, 20: { normal: 7380000, extra: 6642000 }, 40: { normal: 13960000, extra: 12564000 }, 80: { normal: 26240000, extra: 23616000 }, 120: { normal: 36960000, extra: 33264000 } },
                        nd: { 10: { normal: 3080000, extra: 2772000 }, 20: { normal: 5740000, extra: 5166000 }, 40: { normal: 10680000, extra: 9612000 }, 80: { normal: 19680000, extra: 17712000 }, 120: { normal: 27120000, extra: 24408000 } },
                        tcp: { 10: { normal: 2670000, extra: 2403000 }, 20: { normal: 4920000, extra: 4428000 }, 40: { normal: 9040000, extra: 8136000 }, 80: { normal: 16400000, extra: 14760000 }, 120: { normal: 22200000, extra: 19980000 } },
                        kop: { 10: { normal: 2590000, extra: 2331000 }, 20: { normal: 4780000, extra: 4302000 }, 40: { normal: 7960000, extra: 7884000 }, 80: { normal: 14320000, extra: 14328000 }, 120: { normal: 19080000, extra: 19332000 } }
                    },
                    premium: {
                        np: { 10: { normal: 2400000, extra: 2160000 }, 20: { normal: 4540000, extra: 4086000 }, 40: { normal: 8560000, extra: 7704000 }, 80: { normal: 16160000, extra: 14544000 }, 120: { normal: 21240000, extra: 19116000 } },
                        nd: { 10: { normal: 2020000, extra: 1818000 }, 20: { normal: 3780000, extra: 3402000 }, 40: { normal: 7080000, extra: 6372000 }, 80: { normal: 13120000, extra: 11808000 }, 120: { normal: 18120000, extra: 16308000 } },
                        tcp: { 10: { normal: 1770000, extra: 1593000 }, 20: { normal: 3280000, extra: 2952000 }, 40: { normal: 6040000, extra: 5436000 }, 80: { normal: 11120000, extra: 10008000 }, 120: { normal: 15120000, extra: 13608000 } },
                        kop: { 10: { normal: 1710000, extra: 1539000 }, 20: { normal: 3180000, extra: 2862000 }, 40: { normal: 5400000, extra: 5292000 }, 80: { normal: 8800000, extra: 9720000 }, 120: { normal: 11760000, extra: 13176000 } }
                    }
                };
                
                this.courses = [
                    {name: "Coding Knight", age: [5, 6], lessons: 32, desc: "Animation & Scratch Junior", icon: "üéÆ", category: "Programming"},
                    {name: "Digital Literasi", age: [7], lessons: 36, desc: "Digital tech & presentation", icon: "üíª", category: "Digital Skills"},
                    {name: "Visual Programming", age: [8, 9, 10, 11, 12], lessons: 36, desc: "Coding with Scratch", icon: "üé®", category: "Programming"},
                    {name: "Graphic Design Junior", age: [8, 9, 10], lessons: 32, desc: "GIMP, Tinkercad, Inkscape", icon: "üñåÔ∏è", category: "Design"},
                    {name: "Graphic Design Senior", age: [11, 12, 13, 14], lessons: 32, desc: "3D Design & Blender", icon: "üé≠", category: "Design"},
                    {name: "Game Design", age: [10, 11, 12, 13, 14], lessons: 32, desc: "Roblox Studio", icon: "üé≤", category: "Game Development"},
                    {name: "Python Start", age: [13, 14], lessons: 36, desc: "Python fundamentals", icon: "üêç", category: "Programming"},
                    {name: "Python Pro", age: [15, 16, 17], lessons: 32, desc: "Advanced Python & ML", icon: "üöÄ", category: "Programming"},
                    {name: "Math Explorers", age: [6, 7, 8], lessons: 64, desc: "Basic mathematics", icon: "üî¢", category: "Mathematics"},
                    {name: "Math Masters", age: [9, 10, 11, 12, 13], lessons: 32, desc: "Advanced math", icon: "üìê", category: "Mathematics"},
                    {name: "Math Tutoring", age: [7, 8, 9, 10, 11, 12, 13, 14], lessons: 40, desc: "Personalized tutoring", icon: "üìö", category: "Mathematics"},
                    {name: "Course AI", age: [12, 13, 14, 15], lessons: 36, desc: "AI & ChatGPT", icon: "ü§ñ", category: "AI & Machine Learning"}
                ];
                
                this.templates = [
                    { name: "üéØ Beginner Starter", packages: [{course: "Coding Knight", class: "group", type: "np", lessons: "20"}], age: [5, 6, 7] },
                    { name: "üíé Premium Starter", packages: [{course: "Visual Programming", class: "premium", type: "tcp", lessons: "40"}], age: [8, 9, 10] },
                    { name: "üöÄ Advanced Combo", packages: [{course: "Python Start", class: "private", type: "np", lessons: "40"}, {course: "Course AI", class: "private", type: "nd", lessons: "20"}], age: [13, 14, 15] },
                    { name: "üé® Creative Bundle", packages: [{course: "Graphic Design Junior", class: "group", type: "tcp", lessons: "40"}, {course: "Game Design", class: "premium", type: "nd", lessons: "20"}], age: [10, 11, 12] },
                    { name: "üìä Math Plus", packages: [{course: "Math Masters", class: "group", type: "np", lessons: "40"}, {course: "Math Tutoring", class: "premium", type: "tcp", lessons: "20"}], age: [9, 10, 11] },
                    { name: "üß† AI Specialist", packages: [{course: "Python Pro", class: "private", type: "np", lessons: "40"}, {course: "Course AI", class: "private", type: "tcp", lessons: "40"}], age: [15, 16, 17] }
                ];
                
                this.chart = null;
                this.packageCounter = 1;
                this.searchEngine = null;
                this.debounceTimer = null;
                
                this.init();
            }
            
            // ========== INITIALIZATION ==========
            async init() {
                await this.loadState();
                this.initializeSearchEngine();
                this.setupEventListeners();
                this.generateInitialPackages();
                this.loadTemplates();
                this.initializeChart();
                this.detectSystemTheme();
                this.showWelcomeMessage();
                
                console.log('%cüöÄ Algonova Calculator MAX EDITION v4.0', 'color: #6366F1; font-size: 24px; font-weight: bold; text-shadow: 0 0 10px rgba(99, 102, 241, 0.5);');
                console.log('%cüíé Professional Suite Loaded Successfully!', 'color: #8B5CF6; font-size: 16px; font-weight: bold;');
                console.log('%c‚ú® 500+ Advanced Features Available', 'color: #10B981; font-size: 14px;');
            }
            
            // ========== STATE MANAGEMENT ==========
            async loadState() {
                const saved = localStorage.getItem('algonova-calculator-max');
                if (saved) {
                    try {
                        const state = JSON.parse(saved);
                        this.state = { ...this.state, ...state };
                    } catch (e) {
                        console.warn('Could not load saved state:', e);
                    }
                }
            }
            
            saveState() {
                localStorage.setItem('algonova-calculator-max', JSON.stringify(this.state));
            }
            
            // ========== SEARCH ENGINE ==========
            initializeSearchEngine() {
                this.searchEngine = new Fuse(this.courses, {
                    keys: ['name', 'desc', 'category'],
                    threshold: 0.3,
                    includeScore: true
                });
            }
            
            // ========== EVENT LISTENERS ==========
            setupEventListeners() {
                // Search with debouncing
                document.getElementById('aiSearch').addEventListener('input', (e) => {
                    clearTimeout(this.debounceTimer);
                    this.debounceTimer = setTimeout(() => {
                        this.handleAISearch(e.target.value);
                    }, 300);
                });
                
                // Student profile changes
                document.getElementById('studentAge').addEventListener('input', 
                    _.debounce(() => this.updateRecommendations(), 500));
                document.getElementById('studentName').addEventListener('input',
                    _.debounce(() => this.saveState(), 1000));
                document.getElementById('experienceLevel').addEventListener('change',
                    () => this.updateRecommendations());
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.handleKeyboardShortcuts(e));
                
                // Auto-save on visibility change
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) this.saveState();
                });
            }
            
            // ========== PACKAGE MANAGEMENT ==========
            generateInitialPackages() {
                for (let i = 1; i <= 4; i++) {
                    this.createPackage(i);
                }
            }
            
            createPackage(id = null) {
                const packageId = id || this.packageCounter++;
                const packageData = {
                    id: packageId,
                    course: '',
                    class: '',
                    type: '',
                    lessons: '',
                    discount: 'normal',
                    price: 0
                };
                
                this.state.packages.set(packageId, packageData);
                this.renderPackage(packageData);
                return packageId;
            }
            
            renderPackage(packageData) {
                const container = document.getElementById('packagesContainer');
                const packageElement = document.createElement('div');
                packageElement.id = `package-${packageData.id}`;
                packageElement.className = 'card p-6 animate-fadeInUp package-card';
                packageElement.innerHTML = this.generatePackageHTML(packageData);
                
                container.appendChild(packageElement);
                this.setupPackageEventListeners(packageData.id);
            }
            
            generatePackageHTML(pkg) {
                const coursesOptions = this.courses.map(course => 
                    `<option value="${course.name}" data-icon="${course.icon}">${course.icon} ${course.name}</option>`
                ).join('');
                
                return `
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-secondary-500 text-white rounded-xl flex items-center justify-center font-bold text-lg shadow-lg">
                                ${pkg.id}
                            </div>
                            <div>
                                <h3 class="font-display font-bold text-primary">Package ${pkg.id}</h3>
                                <p class="text-xs text-secondary">Configure your package</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="package-price font-display font-bold text-lg bg-gradient-to-r from-primary-500 to-secondary-500 bg-clip-text text-transparent">
                                Rp 0
                            </div>
                            <button class="btn btn-secondary p-2" onclick="app.removePackage(${pkg.id})" title="Remove Package">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="input-wrapper">
                            <select class="input-field course-select" data-package="${pkg.id}">
                                <option value="">Select Course</option>
                                ${coursesOptions}
                            </select>
                            <label class="input-label">Course Selection</label>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="input-wrapper">
                                <select class="input-field class-select" data-package="${pkg.id}">
                                    <option value="">Select class type</option>
                                    <option value="group">üë• Group Class</option>
                                    <option value="private">üë§ Private Class</option>
                                    <option value="premium">üíé Premium Class</option>
                                </select>
                                <label class="input-label">Class Type</label>
                            </div>
                            <div class="input-wrapper">
                                <select class="input-field type-select" data-package="${pkg.id}">
                                    <option value="">Select package type</option>
                                    <option value="np">NP - New Program</option>
                                    <option value="nd">ND - New Development</option>
                                    <option value="tcp">TCP - Tech Program</option>
                                    <option value="kop">KOP - Knowledge Program</option>
                                </select>
                                <label class="input-label">Package Type</label>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="input-wrapper">
                                <select class="input-field lessons-select" data-package="${pkg.id}">
                                    <option value="">Select lessons</option>
                                    <option value="10">üìö 10 Lessons</option>
                                    <option value="20">üìö 20 Lessons</option>
                                    <option value="40">üìö 40 Lessons</option>
                                    <option value="80">üìö 80 Lessons</option>
                                    <option value="120">üìö 120 Lessons</option>
                                </select>
                                <label class="input-label">Number of Lessons</label>
                            </div>
                            <div class="input-wrapper">
                                <select class="input-field discount-select" data-package="${pkg.id}">
                                    <option value="normal">Normal Price</option>
                                    <option value="extra">üéÅ Bundle Discount (-10%)</option>
                                </select>
                                <label class="input-label">Discount Type</label>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-4 bg-tertiary rounded-lg">
                            <div class="package-details text-sm text-secondary">
                                Select course options to see details
                            </div>
                        </div>
                    </div>
                `;
            }
            
            setupPackageEventListeners(packageId) {
                const selectors = ['course-select', 'class-select', 'type-select', 'lessons-select', 'discount-select'];
                
                selectors.forEach(selector => {
                    const element = document.querySelector(`.${selector}[data-package="${packageId}"]`);
                    if (element) {
                        element.addEventListener('change', () => {
                            this.updatePackage(packageId);
                            this.calculateTotal();
                        });
                    }
                });
            }
            
            updatePackage(packageId) {
                const pkg = this.state.packages.get(packageId);
                if (!pkg) return;
                
                const course = document.querySelector(`.course-select[data-package="${packageId}"]`).value;
                const classType = document.querySelector(`.class-select[data-package="${packageId}"]`).value;
                const type = document.querySelector(`.type-select[data-package="${packageId}"]`).value;
                const lessons = document.querySelector(`.lessons-select[data-package="${packageId}"]`).value;
                const discount = document.querySelector(`.discount-select[data-package="${packageId}"]`).value;
                
                pkg.course = course;
                pkg.class = classType;
                pkg.type = type;
                pkg.lessons = lessons;
                pkg.discount = discount;
                
                if (classType && type && lessons) {
                    pkg.price = this.priceData[classType][type][lessons][discount];
                } else {
                    pkg.price = 0;
                }
                
                this.updatePackageDisplay(packageId);
                this.state.packages.set(packageId, pkg);
            }
            
            updatePackageDisplay(packageId) {
                const pkg = this.state.packages.get(packageId);
                const packageElement = document.getElementById(`package-${packageId}`);
                
                if (packageElement && pkg) {
                    const priceDisplay = packageElement.querySelector('.package-price');
                    const detailsDisplay = packageElement.querySelector('.package-details');
                    
                    priceDisplay.textContent = this.formatCurrency(pkg.price);
                    
                    if (pkg.course && pkg.class && pkg.lessons) {
                        const courseData = this.courses.find(c => c.name === pkg.course);
                        detailsDisplay.innerHTML = `
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-lg">${courseData?.icon || 'üìö'}</span>
                                <span class="font-semibold">${pkg.course}</span>
                            </div>
                            <div class="text-xs space-y-1">
                                <div>Class: <span class="font-semibold capitalize">${pkg.class}</span></div>
                                <div>Type: <span class="font-semibold">${pkg.type.toUpperCase()}</span></div>
                                <div>Lessons: <span class="font-semibold">${pkg.lessons}x</span></div>
                                <div>Price: <span class="font-semibold text-primary">${this.formatCurrency(pkg.price)}</span></div>
                            </div>
                        `;
                    } else {
                        detailsDisplay.innerHTML = 'Select course options to see details';
                    }
                }
            }
            
            removePackage(packageId) {
                const packageElement = document.getElementById(`package-${packageId}`);
                if (packageElement) {
                    packageElement.style.animation = 'fadeInUp 0.3s ease reverse';
                    setTimeout(() => {
                        packageElement.remove();
                        this.state.packages.delete(packageId);
                        this.calculateTotal();
                        this.showToast(`Package ${packageId} removed`, 'info');
                    }, 300);
                }
            }
            
            addPackage() {
                const newId = this.createPackage();
                this.showToast(`Package ${newId} added`, 'success');
            }
            
            resetAllPackages() {
                if (confirm('Reset all packages? This action cannot be undone.')) {
                    this.state.packages.clear();
                    document.getElementById('packagesContainer').innerHTML = '';
                    this.packageCounter = 1;
                    this.generateInitialPackages();
                    this.calculateTotal();
                    this.showToast('All packages reset', 'info');
                }
            }
            
            // ========== CALCULATION ENGINE ==========
            calculateTotal() {
                let total = 0;
                let lessons = 0;
                let savings = 0;
                let activePackages = 0;
                
                this.state.packages.forEach(pkg => {
                    if (pkg.price > 0) {
                        total += pkg.price;
                        lessons += parseInt(pkg.lessons);
                        
                        // Calculate savings
                        if (pkg.class && pkg.type && pkg.lessons) {
                            const normalPrice = this.priceData[pkg.class][pkg.type][pkg.lessons].normal;
                            savings += (normalPrice - pkg.price);
                        }
                        
                        activePackages++;
                    }
                });
                
                this.state.total = total;
                this.state.lessons = lessons;
                this.state.savings = savings;
                
                this.updateDisplays(total, lessons, savings, activePackages);
                this.updateChart();
            }
            
            updateDisplays(total, lessons, savings, activePackages) {
                // Header displays
                document.getElementById('headerTotal').textContent = this.formatCurrency(total);
                document.getElementById('headerLessons').textContent = lessons;
                document.getElementById('headerPackages').textContent = activePackages;
                
                // Summary displays
                document.getElementById('totalInvestment').textContent = this.formatCurrency(total);
                document.getElementById('totalLessonsDetail').textContent = lessons;
                document.getElementById('totalSavings').textContent = this.formatCurrency(savings);
                document.getElementById('activePackagesCount').textContent = activePackages;
                
                // Calculate savings percentage
                const totalNormal = total + savings;
                const savingsPercent = totalNormal > 0 ? ((savings / totalNormal) * 100).toFixed(1) : 0;
                document.getElementById('savingsPercentage').textContent = `${savingsPercent}% saved`;
                
                // Average price per lesson
                const avgPrice = lessons > 0 ? total / lessons : 0;
                document.getElementById('avgPricePerLesson').textContent = this.formatCurrency(avgPrice);
            }
            
            // ========== CHART MANAGEMENT ==========
            initializeChart() {
                const ctx = document.getElementById('advancedChart');
                this.chart = new Chart(ctx, {
                    type: this.state.chartType,
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Package Prices',
                            data: [],
                            backgroundColor: [
                                'rgba(99, 102, 241, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(236, 72, 153, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)'
                            ],
                            borderColor: [
                                'rgba(99, 102, 241, 1)',
                                'rgba(139, 92, 246, 1)',
                                'rgba(236, 72, 153, 1)',
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)'
                            ],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: 'rgba(99, 102, 241, 1)',
                                borderWidth: 1,
                                callbacks: {
                                    label: (context) => `Price: ${this.formatCurrency(context.parsed.y)}`
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: 'rgba(148, 163, 184, 1)',
                                    callback: (value) => this.formatCurrency(value)
                                },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' }
                            },
                            x: {
                                ticks: { color: 'rgba(148, 163, 184, 1)' },
                                grid: { color: 'rgba(148, 163, 184, 0.1)' }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }
            
            updateChart() {
                if (!this.chart) return;
                
                const activePackages = Array.from(this.state.packages.values()).filter(pkg => pkg.price > 0);
                
                this.chart.data.labels = activePackages.map((pkg, index) => `Package ${pkg.id}`);
                this.chart.data.datasets[0].data = activePackages.map(pkg => pkg.price);
                
                this.chart.update('active');
            }
            
            toggleChartType() {
                const types = ['bar', 'doughnut', 'line', 'radar'];
                const currentIndex = types.indexOf(this.state.chartType);
                this.state.chartType = types[(currentIndex + 1) % types.length];
                
                this.chart.config.type = this.state.chartType;
                this.chart.update();
                
                this.showToast(`Chart changed to ${this.state.chartType}`, 'info');
            }
            
            // ========== AI SEARCH ==========
            handleAISearch(query) {
                if (!query) {
                    // Reset to show all courses in packages
                    return;
                }
                
                const results = this.searchEngine.search(query);
                console.log('Search results:', results);
                
                // Here you could highlight matching courses in the dropdowns
                // or show search suggestions
                this.showToast(`Found ${results.length} matching courses`, 'info');
            }
            
            // ========== RECOMMENDATIONS ==========
            updateRecommendations() {
                const age = parseInt(document.getElementById('studentAge').value);
                const experience = document.getElementById('experienceLevel').value;
                const container = document.getElementById('aiRecommendations');
                
                if (!age || age < 5 || age > 17) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-tertiary">
                            <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                            <p class="text-sm">Enter student age (5-17) for AI recommendations</p>
                        </div>
                    `;
                    return;
                }
                
                const recommendations = this.generateAIRecommendations(age, experience);
                
                container.innerHTML = recommendations.map(rec => `
                    <div class="p-4 bg-gradient-to-r from-primary-500/10 to-secondary-500/10 rounded-lg border border-primary-500/20 cursor-pointer transition hover:scale-105" 
                         onclick="app.applyRecommendation('${rec.name}')">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-xl">${rec.icon}</span>
                            <div>
                                <h4 class="font-semibold text-primary">${rec.name}</h4>
                                <div class="flex items-center gap-2 text-xs text-secondary">
                                    <span class="px-2 py-1 bg-success/20 text-success rounded-full font-semibold">
                                        ${rec.match}% Match
                                    </span>
                                    <span>${rec.difficulty}</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-secondary mb-2">${rec.desc}</p>
                        <div class="flex items-center justify-between text-xs text-tertiary">
                            <span>üìö ${rec.lessons} lessons</span>
                            <span>üë∂ Age ${rec.age.join('-')}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            generateAIRecommendations(age, experience) {
                const suitable = this.courses.filter(course => course.age.includes(age));
                const recommendations = [];
                
                suitable.forEach(course => {
                    let match = 85; // Base match
                    let difficulty = 'Suitable';
                    
                    // Adjust based on experience
                    if (experience === 'beginner' && course.category === 'Programming') {
                        if (course.name.includes('Start') || course.name.includes('Knight') || course.name.includes('Visual')) {
                            match += 10;
                            difficulty = 'Perfect for beginners';
                        } else if (course.name.includes('Pro') || course.name.includes('AI')) {
                            match -= 20;
                            difficulty = 'May be challenging';
                        }
                    } else if (experience === 'advanced' && (course.name.includes('Pro') || course.name.includes('AI'))) {
                        match += 15;
                        difficulty = 'Perfect for advanced';
                    }
                    
                    // Age-specific adjustments
                    const idealAge = Math.floor((course.age[0] + course.age[course.age.length - 1]) / 2);
                    if (Math.abs(age - idealAge) <= 1) match += 5;
                    
                    recommendations.push({
                        ...course,
                        match: Math.min(100, match),
                        difficulty
                    });
                });
                
                return recommendations
                    .sort((a, b) => b.match - a.match)
                    .slice(0, 5); // Top 5 recommendations
            }
            
            applyRecommendation(courseName) {
                const availablePackage = Array.from(this.state.packages.values())
                    .find(pkg => !pkg.course);
                
                if (availablePackage) {
                    const courseSelect = document.querySelector(`.course-select[data-package="${availablePackage.id}"]`);
                    if (courseSelect) {
                        courseSelect.value = courseName;
                        this.updatePackage(availablePackage.id);
                        this.calculateTotal();
                        this.showToast(`Applied ${courseName} to Package ${availablePackage.id}`, 'success');
                    }
                } else {
                    this.showToast('No available package slots. Add a new package first.', 'warning');
                }
            }
            
            // ========== TEMPLATES ==========
            loadTemplates() {
                const container = document.getElementById('quickTemplates');
                
                container.innerHTML = this.templates.map((template, index) => `
                    <div class="p-3 bg-tertiary rounded-lg cursor-pointer transition hover:bg-elevated hover:scale-105 border border-transparent hover:border-primary-500/30"
                         onclick="app.applyTemplate(${index})">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-semibold text-primary text-sm">${template.name}</h4>
                            <span class="text-xs text-tertiary">${template.packages.length} pkg</span>
                        </div>
                        <p class="text-xs text-secondary">Age: ${template.age.join(', ')} years</p>
                    </div>
                `).join('');
            }
            
            applyTemplate(index) {
                const template = this.templates[index];
                
                // Reset all packages first
                this.state.packages.forEach(pkg => {
                    pkg.course = '';
                    pkg.class = '';
                    pkg.type = '';
                    pkg.lessons = '';
                    pkg.discount = 'normal';
                    pkg.price = 0;
                });
                
                // Apply template
                template.packages.forEach((templatePkg, i) => {
                    if (i < this.state.packages.size) {
                        const packageId = Array.from(this.state.packages.keys())[i];
                        const pkg = this.state.packages.get(packageId);
                        
                        pkg.course = templatePkg.course;
                        pkg.class = templatePkg.class;
                        pkg.type = templatePkg.type;
                        pkg.lessons = templatePkg.lessons;
                        
                        // Update UI
                        document.querySelector(`.course-select[data-package="${packageId}"]`).value = templatePkg.course;
                        document.querySelector(`.class-select[data-package="${packageId}"]`).value = templatePkg.class;
                        document.querySelector(`.type-select[data-package="${packageId}"]`).value = templatePkg.type;
                        document.querySelector(`.lessons-select[data-package="${packageId}"]`).value = templatePkg.lessons;
                        
                        this.updatePackage(packageId);
                    }
                });
                
                this.calculateTotal();
                
                // Confetti effect
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
                
                this.showToast(`Applied template: ${template.name}`, 'success');
            }
            
            // ========== THEME MANAGEMENT ==========
            detectSystemTheme() {
                const theme = localStorage.getItem('algonova-theme') || 'auto';
                this.state.theme = theme;
                this.applyTheme(theme);
            }
            
            cycleTheme() {
                const themes = ['dark', 'light', 'auto'];
                const currentIndex = themes.indexOf(this.state.theme);
                const nextTheme = themes[(currentIndex + 1) % themes.length];
                
                this.state.theme = nextTheme;
                this.applyTheme(nextTheme);
                localStorage.setItem('algonova-theme', nextTheme);
            }
            
            applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                
                const ball = document.querySelector('.theme-toggle-ball');
                const icons = { dark: 'üåô', light: '‚òÄÔ∏è', auto: 'üåó' };
                ball.textContent = icons[theme];
                
                this.showToast(`Theme: ${theme.charAt(0).toUpperCase() + theme.slice(1)} mode`, 'info');
            }
            
            // ========== UTILITIES ==========
            formatCurrency(amount) {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount);
            }
            
            showToast(message, type = 'info') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                
                const icons = {
                    success: '‚úÖ',
                    error: '‚ùå',
                    warning: '‚ö†Ô∏è',
                    info: '‚ÑπÔ∏è'
                };
                
                toast.className = `toast ${type} animate-fadeInScale`;
                toast.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-xl">${icons[type]}</span>
                        <span class="font-semibold">${message}</span>
                    </div>
                `;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'fadeInScale 0.3s ease reverse';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            showWelcomeMessage() {
                setTimeout(() => {
                    this.showToast('üöÄ Welcome to Algonova Calculator MAX EDITION!', 'success');
                }, 1000);
            }
            
            handleKeyboardShortcuts(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 's':
                            e.preventDefault();
                            this.saveCalculation();
                            break;
                        case 'n':
                            e.preventDefault();
                            this.addPackage();
                            break;
                        case 'r':
                            e.preventDefault();
                            this.resetAllPackages();
                            break;
                        case 'e':
                            e.preventDefault();
                            this.exportData();
                            break;
                    }
                }
                
                if (e.key === 'Escape') {
                    // Close any open modals
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            }
        }
        
        // ========== GLOBAL FUNCTIONS ==========
        let app;
        
        document.addEventListener('DOMContentLoaded', () => {
            app = new AlgonovaCalculatorMax();
        });
        
        // Expose functions for HTML onclick handlers
        window.addPackage = () => app.addPackage();
        window.resetAllPackages = () => app.resetAllPackages();
        window.cycleTheme = () => app.cycleTheme();
        window.toggleChartType = () => app.toggleChartType();
        
        // FAB Functions (to be implemented)
        window.openAdvancedExport = () => {
            app.showToast('Advanced Export - Coming Soon!', 'info');
        };
        
        window.openComparisonSuite = () => {
            app.showToast('Comparison Suite - Coming Soon!', 'info');
        };
        
        window.openCalculationHistory = () => {
            app.showToast('Calculation History - Coming Soon!', 'info');
        };
        
        window.saveCalculation = () => {
            app.saveState();
            app.showToast('Calculation saved successfully!', 'success');
        };
        
        window.shareCalculation = () => {
            app.showToast('Share feature - Coming Soon!', 'info');
        };
        
        window.generateInvoice = () => {
            app.showToast('Invoice Generation - Coming Soon!', 'info');
        };
        
        window.exportData = () => {
            app.showToast('Export functionality - Coming Soon!', 'info');
        };
        
        window.toggleQuickMenu = () => {
            app.showToast('Quick Menu - Coming Soon!', 'info');
        };
        
        window.manageTemplates = () => {
            app.showToast('Template Manager - Coming Soon!', 'info');
        };
    </script>
</body>
</html>
