<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Algonova Calculator Ultra Pro MAX | Mi Raj v4.0</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.0/dist/vanilla-tilt.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Manrope:wght@600;700;800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ===== ROOT VARIABLES - ULTRA ENHANCED ===== */
:root {
  --primary: #6366F1; --primary-dark: #4F46E5; --secondary: #8B5CF6; --tertiary: #A78BFA;
  --accent: #EC4899; --accent2: #F43F5E; --success: #10B981; --success2: #059669;
  --warning: #F59E0B; --warning2: #D97706; --danger: #EF4444; --danger2: #DC2626;
  --info: #3B82F6; --info2: #2563EB;
  --bg-main: #090D18; --bg-card: #141B2D; --bg-elevated: #1E293B; --bg-input: #0F1623;
  --text-primary: #F8FAFC; --text-secondary: #CBD5E1; --text-muted: #94A3B8;
  --border: #253347; --border-light: #374151; --glass-bg: rgba(21, 32, 54, 0.75);
  --gradient-primary: linear-gradient(135deg, var(--primary), var(--secondary));
  --gradient-accent: linear-gradient(135deg, var(--accent), var(--secondary));
  --gradient-success: linear-gradient(135deg, var(--success), var(--success2));
  --gradient-warning: linear-gradient(135deg, var(--warning), var(--warning2));
  --transition-fast: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-normal: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  --shadow-sm: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-md: 0 10px 25px rgba(0, 0, 0, 0.2);
  --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.3);
  --shadow-glow: 0 0 25px rgba(99, 102, 241, 0.4);
  --border-radius-sm: 12px; --border-radius-md: 18px; --border-radius-lg: 24px; --border-radius-xl: 28px;
}

[data-theme="light"] {
  --bg-main: #F1F5F9; --bg-card: #FFFFFF; --bg-elevated: #F8FAFC; --bg-input: #FFFFFF;
  --text-primary: #0F172A; --text-secondary: #475569; --text-muted: #64748B;
  --border: #E2E8F0; --border-light: #CBD5E1; --glass-bg: rgba(255, 255, 255, 0.85);
}

/* ===== BASE STYLES ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }
:root { color-scheme: dark; }
body {
  font-family: 'Inter', sans-serif; background: var(--bg-main); color: var(--text-primary);
  line-height: 1.5; -webkit-font-smoothing: antialiased; overflow-x: hidden;
  transition: var(--transition-normal); min-height: 100vh;
}
*::-webkit-scrollbar { width: 10px; height: 10px; }
*::-webkit-scrollbar-track { background: transparent; }
*::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 5px; border: 3px solid transparent; background-clip: content-box; }
*::-webkit-scrollbar-thumb:hover { background: var(--primary); }

/* ===== PARTICLE BACKGROUND ===== */
#particles-js {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
  background: radial-gradient(circle at center, var(--bg-main) 0%, #020408 100%);
}
.particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

/* ===== GLASSMORPHISM EFFECTS ===== */
.glass {
  background: var(--glass-bg);
  backdrop-filter: blur(30px) saturate(180%);
  -webkit-backdrop-filter: blur(30px) saturate(180%);
  border: 1px solid var(--border);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
}

.glass-heavy {
  background: rgba(21, 32, 54, 0.88);
  backdrop-filter: blur(40px) saturate(200%);
  -webkit-backdrop-filter: blur(40px) saturate(200%);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
}

/* ===== ANIMATED GRADIENT BORDERS ===== */
.gradient-border {
  position: relative; overflow: hidden; border-radius: var(--border-radius-md);
}
.gradient-border::before {
  content: ''; position: absolute; inset: -2px; z-index: -1;
  background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent), var(--primary));
  animation: rotateGradient 8s linear infinite;
  opacity: 0.7;
}
.gradient-border::after {
  content: ''; position: absolute; inset: 0; 
  background: var(--bg-card); border-radius: var(--border-radius-md);
}

@keyframes rotateGradient {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* ===== CARD ENHANCEMENTS ===== */
.card {
  background: var(--bg-card); border-radius: var(--border-radius-md);
  transition: var(--transition-normal); position: relative; overflow: hidden;
  box-shadow: var(--shadow-md); border: 1px solid var(--border);
}
.card:hover {
  transform: translateY(-6px); box-shadow: var(--shadow-lg), var(--shadow-glow);
  border-color: rgba(99, 102, 241, 0.4);
}
.card-3d { transform-style: preserve-3d; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

/* ===== BADGE & CHIP STYLES ===== */
.badge {
  display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.4rem 0.9rem;
  font-size: 0.725rem; font-weight: 700; border-radius: 50px;
  background: var(--gradient-primary); color: white;
  animation: badgePulse 2.5s infinite; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.35);
  white-space: nowrap;
}
.badge-accent { background: var(--gradient-accent); }
.badge-success { background: var(--gradient-success); }
.badge-warning { background: var(--gradient-warning); }

@keyframes badgePulse {
  0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
  70% { transform: scale(1.05); box-shadow: 0 0 0 8px rgba(255, 255, 255, 0); }
}

/* ===== BUTTONS ===== */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 0.625rem;
  padding: 0.875rem 1.5rem; font-size: 0.875rem; font-weight: 600; 
  border-radius: var(--border-radius-sm); border: none; cursor: pointer;
  transition: var(--transition-fast); position: relative; overflow: hidden;
  min-height: 44px;
}
.btn::before {
  content: ''; position: absolute; inset: 0; opacity: 0;
  background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
  transform: scale(0.8); transition: transform 0.5s, opacity 0.5s;
}
.btn:hover::before { transform: scale(2.5); opacity: 1; }
.btn:active { transform: scale(0.97); }
.btn-primary { background: var(--gradient-primary); color: white; box-shadow: var(--shadow-glow); }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(99, 102, 241, 0.45); }
.btn-success { background: var(--gradient-success); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
.btn-warning { background: var(--gradient-warning); color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
.btn-danger { background: var(--gradient-danger, linear-gradient(135deg, var(--danger), var(--danger2))); color: white; }
.btn-outline {
  background: transparent; border: 2px solid var(--border-light); color: var(--text-secondary);
}
.btn-outline:hover {
  border-color: var(--primary); color: var(--primary);
  background: rgba(99, 102, 241, 0.08);
}

/* ===== INPUTS ===== */
.input-field {
  width: 100%; padding: 0.875rem 1.125rem; font-size: 0.925rem; font-weight: 500;
  color: var(--text-primary); background: var(--bg-input); 
  border: 2px solid var(--border); border-radius: var(--border-radius-sm);
  transition: var(--transition-fast); outline: none;
}
.input-field:focus {
  border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
  transform: translateY(-1px); background: var(--bg-elevated);
}
.input-label {
  display: block; font-size: 0.725rem; font-weight: 700; color: var(--text-secondary);
  margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.06em;
  display: flex; align-items: center; gap: 0.375rem;
}

/* ===== HEADER ===== */
.header {
  flex-shrink: 0; background: var(--glass-bg); backdrop-filter: blur(30px) saturate(180%);
  -webkit-backdrop-filter: blur(30px) saturate(180%); border-bottom: 1px solid var(--border);
  padding: 0.875rem 0; z-index: 40; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.18);
  position: sticky; top: 0;
}
.header-content { max-width: 1600px; margin: 0 auto; padding: 0 1.5rem; display: flex; align-items: center; justify-content: space-between; }

/* ===== MAIN LAYOUT ===== */
.main-container { display: flex; flex-direction: column; min-height: 100vh; }
.content-area { 
  flex: 1; display: flex; padding: 1.25rem 1.5rem; gap: 1.25rem; max-width: 1600px; 
  margin: 0 auto; width: 100%; overflow: hidden;
}
.packages-area { flex: 1; overflow-y: auto; padding-right: 0.5rem; display: flex; flex-direction: column; gap: 1.25rem; }
.summary-area { width: 400px; flex-shrink: 0; overflow-y: auto; padding-left: 0.5rem; display: flex; flex-direction: column; gap: 1.25rem; }

/* ===== ANALYTICS CARD ===== */
.analytics-card {
  background: var(--gradient-primary); color: white; border-radius: var(--border-radius-lg);
  padding: 1.75rem; position: relative; overflow: hidden; box-shadow: var(--shadow-lg);
}
.analytics-card::before {
  content: ''; position: absolute; top: -50%; right: -50%; width: 200%; height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
  animation: rotate 25s linear infinite;
}
@keyframes rotate { to { transform: rotate(360deg); } }

.stats-grid { 
  display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1.25rem; 
}
.stat-item {
  background: rgba(255, 255, 255, 0.12); backdrop-filter: blur(12px);
  padding: 1.125rem; border-radius: 16px; border: 1px solid rgba(255, 255, 255, 0.15);
  transition: var(--transition-fast);
}
.stat-item:hover { 
  background: rgba(255, 255, 255, 0.18); transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}
.stat-value { 
  font-size: 1.75rem; font-weight: 800; font-family: 'Manrope', sans-serif;
  background: linear-gradient(to right, white, #cbd5e1); -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.stat-label { 
  font-size: 0.825rem; opacity: 0.92; margin-top: 0.375rem; letter-spacing: 0.02em;
}

/* ===== CHART CONTAINER ===== */
.chart-container { 
  position: relative; height: 240px; margin-top: 1.25rem; border-radius: 16px;
  overflow: hidden; background: var(--bg-elevated); padding: 1.25rem;
  transition: var(--transition-fast);
}
.chart-container:hover { 
  border: 1px solid var(--primary); transform: scale(1.01);
}

/* ===== FAB & RADIAL MENU ===== */
.fab-container {
  position: fixed; bottom: 2.5rem; right: 2.5rem; z-index: 100;
  display: flex; flex-direction: column; align-items: flex-end; gap: 1.125rem;
}
.fab {
  width: 64px; height: 64px; border-radius: 50%;
  background: var(--gradient-primary); color: white;
  display: flex; align-items: center; justify-content: center; cursor: pointer;
  box-shadow: 0 10px 35px rgba(99, 102, 241, 0.45); border: none;
  transition: var(--transition-normal); position: relative; font-size: 1.375rem;
}
.fab:hover { 
  transform: scale(1.18) rotate(6deg); box-shadow: 0 15px 45px rgba(99, 102, 241, 0.6);
}
.fab-tooltip {
  position: absolute; right: 78px; background: var(--bg-card); color: var(--text-primary);
  padding: 0.625rem 1.125rem; border-radius: 14px; font-size: 0.875rem; font-weight: 600;
  white-space: nowrap; opacity: 0; pointer-events: none; transition: var(--transition-fast);
  border: 1px solid var(--border); box-shadow: var(--shadow-md);
  transform: translateX(10px); z-index: 101;
}
.fab:hover .fab-tooltip { 
  opacity: 1; transform: translateX(0); 
}
.radial-menu {
  position: absolute; bottom: 80px; right: 20px; display: flex; flex-direction: column;
  align-items: center; gap: 16px; opacity: 0; pointer-events: none;
  transform: scale(0.8) translateY(20px); transition: var(--transition-normal);
  z-index: 99;
}
.radial-menu.show { 
  opacity: 1; pointer-events: all; transform: scale(1) translateY(0);
}
.radial-item {
  width: 52px; height: 52px; border-radius: 50%; display: flex; align-items: center;
  justify-content: center; background: var(--bg-card); color: var(--text-primary);
  box-shadow: var(--shadow-md); cursor: pointer; font-size: 1.125rem;
  transition: var(--transition-fast); border: 2px solid var(--border);
}
.radial-item:hover {
  transform: scale(1.15) rotate(5deg); background: var(--gradient-primary);
  color: white; border-color: transparent;
  box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
}

/* ===== MODAL STYLES ===== */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(10, 14, 26, 0.92); 
  backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
  display: flex; align-items: center; justify-content: center; z-index: 50;
  opacity: 0; pointer-events: none; transition: opacity 0.35s ease;
}
.modal-overlay.show {
  opacity: 1; pointer-events: all;
}
.modal-content {
  background: var(--bg-card); border: 1px solid var(--border-light); 
  border-radius: var(--border-radius-xl); max-width: 1000px; width: 95%;
  max-height: 92vh; overflow-y: auto; transform: translateY(20px);
  opacity: 0; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), 
              opacity 0.3s ease;
}
.modal-overlay.show .modal-content {
  transform: translateY(0); opacity: 1;
}
.modal-header {
  padding: 1.75rem 2.5rem; border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.modal-close {
  width: 48px; height: 48px; border-radius: 14px; background: var(--bg-elevated);
  border: 1px solid var(--border); cursor: pointer; font-size: 1.625rem;
  color: var(--text-secondary); display: flex; align-items: center; justify-content: center;
  transition: var(--transition-fast);
}
.modal-close:hover {
  background: var(--danger); color: white; border-color: transparent;
  transform: rotate(90deg);
}

/* ===== AI CHAT INTERFACE ===== */
.ai-chat-container {
  background: var(--bg-elevated); border-radius: var(--border-radius-md);
  padding: 1.5rem; margin-top: 1.5rem; max-height: 300px; overflow-y: auto;
  border: 1px solid var(--border); position: relative;
}
.ai-message {
  display: flex; gap: 1rem; margin-bottom: 1.25rem; animation: fadeIn 0.4s ease;
}
.ai-avatar {
  width: 36px; height: 36px; border-radius: 50%; background: var(--gradient-primary);
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  font-weight: 700; font-size: 0.875rem;
}
.ai-content {
  background: var(--bg-card); border-radius: 16px; padding: 1.125rem;
  flex: 1; border: 1px solid var(--border);
}
.user-message .ai-content { 
  background: var(--gradient-primary); color: white; border: none;
}
.ai-input-container {
  display: flex; gap: 0.75rem; margin-top: 1rem;
}
.ai-input {
  flex: 1; padding: 0.875rem 1.25rem; border-radius: 50px; border: 2px solid var(--border);
  background: var(--bg-input); color: var(--text-primary); font-size: 0.925rem;
  transition: var(--transition-fast);
}
.ai-input:focus {
  border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
}
.ai-send-btn {
  width: 48px; height: 48px; border-radius: 50%; background: var(--gradient-primary);
  color: white; border: none; display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: var(--transition-fast); flex-shrink: 0;
}
.ai-send-btn:hover { transform: scale(1.1) rotate(15deg); }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* ===== PAYMENT SIMULATOR ===== */
.payment-simulator {
  background: var(--bg-elevated); border-radius: var(--border-radius-md);
  padding: 1.5rem; margin-top: 1.5rem; border: 1px solid var(--border);
}
.simulator-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 1.25rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border);
}
.simulator-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem;
}
.simulator-item {
  text-align: center; padding: 1rem; border-radius: 14px;
  background: var(--bg-card); transition: var(--transition-fast);
  border: 2px solid transparent;
}
.simulator-item:hover, .simulator-item.active {
  border-color: var(--primary); transform: translateY(-2px);
  background: rgba(99, 102, 241, 0.08);
}
.simulator-value {
  font-size: 1.625rem; font-weight: 800; font-family: 'Manrope', sans-serif;
  margin: 0.5rem 0; background: var(--gradient-primary);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.simulator-label { 
  font-size: 0.825rem; color: var(--text-secondary); 
}

/* ===== ACHIEVEMENT BADGES ===== */
.achievements-container {
  display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1.25rem;
  padding: 1rem; background: var(--bg-elevated); border-radius: var(--border-radius-md);
  border: 1px dashed var(--border);
}
.achievement-badge {
  width: 56px; height: 56px; border-radius: 16px; display: flex;
  align-items: center; justify-content: center; flex-direction: column;
  background: var(--bg-card); border: 2px solid var(--border);
  transition: var(--transition-fast); position: relative;
  font-size: 1.125rem;
}
.achievement-badge.unlocked {
  background: var(--gradient-primary); border-color: transparent;
  transform: scale(1.05); box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
}
.achievement-badge.unlocked::after {
  content: 'âœ“'; position: absolute; bottom: -6px; right: -6px;
  width: 20px; height: 20px; border-radius: 50%; background: var(--success);
  color: white; font-size: 0.625rem; display: flex; align-items: center;
  justify-content: center; font-weight: 700; border: 2px solid var(--bg-card);
}
.achievement-label {
  font-size: 0.625rem; text-align: center; margin-top: 0.25rem;
  color: var(--text-secondary);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1400px) {
  .summary-area { width: 360px; }
}
@media (max-width: 1200px) {
  .packages-grid { grid-template-columns: repeat(2, 1fr); }
  .summary-area { width: 320px; }
}
@media (max-width: 992px) {
  .content-area { flex-direction: column; }
  .summary-area { width: 100%; padding-left: 0; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 768px) {
  .header-content { flex-direction: column; gap: 1rem; text-align: center; }
  .packages-grid { grid-template-columns: 1fr; }
  .stats-grid { grid-template-columns: 1fr; }
  .fab-container { bottom: 1.5rem; right: 1.5rem; }
  .summary-area { order: -1; }
  .simulator-grid { grid-template-columns: 1fr; }
}
@media (max-width: 480px) {
  .analytics-card { padding: 1.25rem; }
  .stat-value { font-size: 1.5rem; }
  .fab { width: 56px; height: 56px; font-size: 1.25rem; }
  .modal-header { padding: 1.25rem 1.75rem; }
}
</style>
</head>
<body>
<!-- Particle Background -->
<div id="particles-js"></div>

<div class="main-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="flex items-center gap-4">
        <div class="gradient-border" style="width: 60px; height: 60px; border-radius: 18px;">
          <div style="width: 100%; height: 100%; border-radius: 16px; display: flex; align-items: center; justify-content: center; background: var(--gradient-primary); color: white; font-size: 2rem; font-weight: 800; box-shadow: var(--shadow-glow);">
            <i class="fas fa-brain"></i>
          </div>
        </div>
        <div>
          <h1 class="font-display" style="font-size: 1.65rem; line-height: 1.1; background: linear-gradient(90deg, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;">
            Algonova Calculator
            <span style="background: linear-gradient(90deg, var(--warning), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 0.85em; letter-spacing: -0.02em;">ULTRA PRO MAX</span>
          </h1>
          <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem; display: flex; align-items: center; gap: 0.75rem;">
            <span class="badge" style="background: var(--gradient-accent); padding: 0.35rem 0.9rem; font-size: 0.75rem;">
              <i class="fas fa-robot"></i> AI-Powered
            </span>
            <span>Team 8 â€¢ By Mi Raj â€¢ v4.0</span>
          </p>
        </div>
      </div>
      
      <div class="flex items-center gap-4">
        <div style="text-align: right;">
          <div style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 600; display: flex; align-items: center; gap: 0.5rem; justify-content: flex-end;">
            <i class="fas fa-wallet"></i> TOTAL INVESTMENT
          </div>
          <div id="headerTotal" class="font-display" style="font-size: 2.15rem; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; line-height: 1.1; margin: 0.15rem 0;">Rp 0</div>
          <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem; display: flex; align-items: center; gap: 0.5rem; justify-content: flex-end;">
            <i class="fas fa-book-open"></i> <span id="headerLessons">0</span> lessons â€¢ 
            <span id="savingsBadge" class="badge badge-success" style="padding: 0.25rem 0.75rem; font-size: 0.65rem; margin-left: 0.5rem; display: none;">
              <i class="fas fa-gem"></i> <span id="headerSavings">Rp 0</span> SAVED
            </span>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <button class="btn btn-outline" id="currencyToggle" style="padding: 0.65rem 1.125rem; font-size: 0.825rem;" title="Toggle Currency (IDR/USD)">
            <i class="fas fa-coins"></i> IDR
          </button>
          
          <div class="theme-toggle" onclick="toggleTheme()" style="width: 76px; height: 38px; border-radius: 19px; cursor: pointer; position: relative;">
            <div class="theme-toggle-ball" style="width: 30px; height: 30px; border-radius: 50%; position: absolute; top: 4px; left: 4px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.85rem; box-shadow: 0 2px 10px rgba(0,0,0,0.2); transition: var(--transition-normal);">
              <i class="fas fa-moon"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Content Area -->
  <div class="content-area">
    <!-- Packages Area -->
    <div class="packages-area">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="packagesGrid">
        <!-- Packages will be generated dynamically -->
      </div>
      
      <!-- AI Course Advisor -->
      <div class="card glass-heavy" style="border-radius: var(--border-radius-lg);">
        <div class="card-header" style="padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border);">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div style="width: 40px; height: 40px; border-radius: 12px; background: var(--gradient-accent); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.125rem; flex-shrink: 0;">
                <i class="fas fa-robot"></i>
              </div>
              <h3 class="font-semibold" style="font-size: 1.125rem;">ðŸ¤– AI Course Advisor</h3>
            </div>
            <span class="badge" style="background: var(--gradient-warning); padding: 0.35rem 0.9rem; font-size: 0.7rem;">
              <i class="fas fa-bolt"></i> Real-time
            </span>
          </div>
        </div>
        <div class="card-body" style="padding: 1.5rem;">
          <div class="ai-chat-container" id="aiChatContainer">
            <div class="ai-message">
              <div class="ai-avatar">AI</div>
              <div class="ai-content">
                Halo! Saya adalah asisten AI Algonova. Beri tahu saya usia anak dan tujuan belajarnya, 
                maka saya akan merekomendasikan paket terbaik dengan penghematan maksimal! ðŸ˜Š
              </div>
            </div>
          </div>
          
          <div class="ai-input-container">
            <input type="text" class="ai-input" id="aiChatInput" placeholder="Contoh: 'anak 10 tahun ingin belajar coding game'">
            <button class="ai-send-btn" id="aiSendBtn">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
          
          <div class="flex flex-wrap gap-2 mt-3">
            <button class="btn btn-outline" style="padding: 0.5rem 0.875rem; font-size: 0.75rem;" onclick="askAI('Apa rekomendasi untuk anak 8 tahun?')">
              <i class="fas fa-child"></i> Usia 8 th
            </button>
            <button class="btn btn-outline" style="padding: 0.5rem 0.875rem; font-size: 0.75rem;" onclick="askAI('Paket hemat untuk 40 pelajaran')">
              <i class="fas fa-percentage"></i> Hemat 40x
            </button>
            <button class="btn btn-outline" style="padding: 0.5rem 0.875rem; font-size: 0.75rem;" onclick="askAI('Optimalkan paket saya saat ini')">
              <i class="fas fa-magic"></i> Optimalkan
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Summary Area -->
    <div class="summary-area">
      <!-- Analytics Card -->
      <div class="analytics-card">
        <div style="position: relative; z-index: 1;">
          <div class="flex items-start justify-between mb-4">
            <div>
              <div style="font-size: 0.75rem; opacity: 0.95; margin-bottom: 0.5rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-chart-line"></i> INVESTMENT SUMMARY
              </div>
              <div id="finalPrice" class="font-display" style="font-size: 2.75rem; font-weight: 900; margin-bottom: 0.5rem; letter-spacing: -0.02em; line-height: 1.05;">Rp 0</div>
              <div style="opacity: 0.95; font-size: 1.05rem; display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;">
                <span><i class="fas fa-book"></i> <span id="totalLessons">0</span> Total Lessons</span>
                <span>â€¢</span>
                <span><i class="fas fa-boxes"></i> <span id="packageCount">0</span> Packages</span>
              </div>
            </div>
            <div class="text-right" style="min-width: 120px;">
              <div style="font-size: 0.75rem; opacity: 0.95; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.4rem; justify-content: flex-end;">
                <i class="fas fa-tag"></i> TOTAL SAVINGS
              </div>
              <div id="totalSavings" class="font-display" style="font-size: 1.875rem; font-weight: 800; background: var(--gradient-success); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.1;">Rp 0</div>
              <div id="savingsPercentage" style="font-size: 0.925rem; color: rgba(255,255,255,0.9); margin-top: 0.25rem; font-weight: 600;">
                (0% dari harga normal)
              </div>
            </div>
          </div>
          
          <!-- Stats Grid -->
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="avgPricePerLesson">Rp 0</div>
              <div class="stat-label"><i class="fas fa-calculator"></i> Avg/Lesson</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="bestValuePackage">-</div>
              <div class="stat-label"><i class="fas fa-gem"></i> Best Value</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="payPerMonth">Rp 0</div>
              <div class="stat-label"><i class="fas fa-calendar-alt"></i> /Month (12x)</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="roiEstimate">0 bln</div>
              <div class="stat-label"><i class="fas fa-chart-pie"></i> ROI Estimate</div>
            </div>
          </div>
          
          <div style="margin-top: 1.75rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <button id="openModalBtn" class="btn btn-success" style="padding: 1rem;">
              <i class="fas fa-file-invoice-dollar"></i> Generate Invoice
            </button>
            <button id="magicOptimizeBtn" class="btn btn-primary" style="padding: 1rem;" title="AI will optimize your packages for maximum savings">
              <i class="fas fa-magic"></i> Magic Optimize
            </button>
          </div>
          
          <!-- Achievements -->
          <div class="achievements-container">
            <div class="achievement-badge" id="bundleMaster" title="Bundle Master: Save over Rp 2.000.000">
              <i class="fas fa-gem"></i>
              <div class="achievement-label">Bundle Master</div>
            </div>
            <div class="achievement-badge" id="lessonChampion" title="Lesson Champion: Purchase 120+ lessons">
              <i class="fas fa-trophy"></i>
              <div class="achievement-label">120+ Lessons</div>
            </div>
            <div class="achievement-badge" id="savingsKing" title="Savings King: Save over 15% of total price">
              <i class="fas fa-crown"></i>
              <div class="achievement-label">15%+ Savings</div>
            </div>
            <div class="achievement-badge" id="aiExplorer" title="AI Explorer: Use AI advisor 3 times">
              <i class="fas fa-rocket"></i>
              <div class="achievement-label">AI Explorer</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Payment Plan Simulator -->
      <div class="card glass">
        <div class="card-header collapsible-header" onclick="toggleCollapsible('paymentSection')" style="padding: 1.125rem 1.5rem;">
          <div class="flex items-center justify-between" style="width: 100%;">
            <div class="flex items-center gap-2.5">
              <div style="width: 32px; height: 32px; border-radius: 10px; background: var(--gradient-warning); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.95rem; flex-shrink: 0;">
                <i class="fas fa-credit-card"></i>
              </div>
              <span style="font-size: 0.925rem; font-weight: 700;">ðŸ’³ Payment Plan Simulator</span>
            </div>
            <i id="paymentSectionIcon" class="fas fa-chevron-down" style="transition: transform 0.3s ease; font-size: 1.125rem;"></i>
          </div>
        </div>
        <div id="paymentSection" class="collapsible-content open">
          <div class="card-body" style="padding: 1.5rem;">
            <div class="payment-simulator">
              <div class="simulator-header">
                <h4 style="font-size: 1.125rem; font-weight: 700; display: flex; align-items: center; gap: 0.625rem;">
                  <i class="fas fa-sliders-h"></i> Customize Your Plan
                </h4>
                <span class="badge" style="padding: 0.35rem 0.9rem; font-size: 0.725rem; background: var(--gradient-accent);">
                  <i class="fas fa-percentage"></i> 0% Interest
                </span>
              </div>
              
              <div class="simulator-grid">
                <div class="simulator-item active" onclick="setInstallmentPlan(1)">
                  <div style="font-size: 0.875rem; color: var(--text-secondary);">Full Payment</div>
                  <div class="simulator-value" id="fullPayment">Rp 0</div>
                  <div style="font-size: 0.825rem; color: var(--success); font-weight: 600;">Save Rp 0</div>
                </div>
                <div class="simulator-item" onclick="setInstallmentPlan(3)">
                  <div style="font-size: 0.875rem; color: var(--text-secondary);">3 Months</div>
                  <div class="simulator-value" id="payment3x">Rp 0</div>
                  <div style="font-size: 0.825rem; color: var(--text-muted);">+0% interest</div>
                </div>
                <div class="simulator-item" onclick="setInstallmentPlan(6)">
                  <div style="font-size: 0.875rem; color: var(--text-secondary);">6 Months</div>
                  <div class="simulator-value" id="payment6x">Rp 0</div>
                  <div style="font-size: 0.825rem; color: var(--text-muted);">+0% interest</div>
                </div>
                <div class="simulator-item" onclick="setInstallmentPlan(12)">
                  <div style="font-size: 0.875rem; color: var(--text-secondary);">12 Months</div>
                  <div class="simulator-value" id="payment12x">Rp 0</div>
                  <div style="font-size: 0.825rem; color: var(--warning); font-weight: 600;">Most Popular</div>
                </div>
              </div>
              
              <div style="margin-top: 1.5rem; padding-top: 1.25rem; border-top: 1px dashed var(--border);">
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                  <span style="color: var(--text-secondary);">Down Payment (30%)</span>
                  <span id="downPayment" class="font-semibold">Rp 0</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span style="color: var(--text-secondary);">Processing Fee</span>
                  <span class="text-success font-semibold">FREE</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Child Age Input -->
      <div class="card glass">
        <div class="card-body" style="padding: 1.5rem;">
          <label class="input-label"><i class="fas fa-birthday-cake"></i> Child Age (Years)</label>
          <div style="display: flex; gap: 0.75rem;">
            <input type="number" id="childAge" min="5" max="17" placeholder="5-17 years" class="input-field" style="flex: 1;">
            <button class="btn btn-primary" style="width: 100px; padding: 0.875rem;" onclick="updateRecommendations()">
              <i class="fas fa-search"></i> Find
            </button>
          </div>
          <div style="margin-top: 1rem; padding: 0.875rem; background: rgba(99, 102, 241, 0.1); border-radius: var(--border-radius-sm); font-size: 0.825rem;">
            <i class="fas fa-info-circle" style="color: var(--primary); margin-right: 0.5rem;"></i>
            Age determines course eligibility and optimal learning path
          </div>
        </div>
      </div>
      
      <!-- Price Chart -->
      <div class="card glass">
        <div class="card-header collapsible-header" onclick="toggleCollapsible('chartSection')" style="padding: 1.125rem 1.5rem;">
          <div class="flex items-center justify-between" style="width: 100%;">
            <div class="flex items-center gap-2.5">
              <div style="width: 32px; height: 32px; border-radius: 10px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.95rem; flex-shrink: 0;">
                <i class="fas fa-chart-bar"></i>
              </div>
              <span style="font-size: 0.925rem; font-weight: 700;">ðŸ“Š Price Analytics</span>
            </div>
            <i id="chartSectionIcon" class="fas fa-chevron-down" style="transition: transform 0.3s ease; font-size: 1.125rem;"></i>
          </div>
        </div>
        <div id="chartSection" class="collapsible-content open">
          <div class="card-body" style="padding: 0.25rem 0.25rem 1.25rem 0.25rem;">
            <div class="chart-container">
              <canvas id="priceChart"></canvas>
            </div>
            <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
              <span class="badge" style="background: rgba(99,102,241,0.15); color: var(--primary); padding: 0.4rem 0.9rem;">
                <i class="fas fa-circle" style="color: var(--primary); margin-right: 0.5rem; font-size: 0.625rem;"></i> Package Value
              </span>
              <span class="badge" style="background: rgba(16,185,129,0.15); color: var(--success); padding: 0.4rem 0.9rem;">
                <i class="fas fa-circle" style="color: var(--success); margin-right: 0.5rem; font-size: 0.625rem;"></i> Avg/Lesson
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Quick Templates -->
      <div class="card glass">
        <div class="card-header collapsible-header" onclick="toggleCollapsible('templatesSection')" style="padding: 1.125rem 1.5rem;">
          <div class="flex items-center justify-between" style="width: 100%;">
            <div class="flex items-center gap-2.5">
              <div style="width: 32px; height: 32px; border-radius: 10px; background: var(--gradient-accent); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.95rem; flex-shrink: 0;">
                <i class="fas fa-bolt"></i>
              </div>
              <span style="font-size: 0.925rem; font-weight: 700;">âš¡ Quick Templates</span>
            </div>
            <i id="templatesSectionIcon" class="fas fa-chevron-down" style="transition: transform 0.3s ease; font-size: 1.125rem;"></i>
          </div>
        </div>
        <div id="templatesSection" class="collapsible-content open">
          <div class="card-body" id="templatesContainer" style="max-height: 280px; overflow-y: auto; padding: 0.75rem;">
            <!-- Templates will be generated -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Action Buttons - Enhanced Radial Menu -->
<div class="fab-container">
  <div class="radial-menu" id="radialMenu">
    <div class="radial-item" onclick="exportToPDF()" title="Export as PDF">
      <i class="fas fa-file-pdf"></i>
    </div>
    <div class="radial-item" onclick="exportToExcel()" title="Export as Excel">
      <i class="fas fa-file-excel"></i>
    </div>
    <div class="radial-item" onclick="exportToJSON()" title="Export as JSON">
      <i class="fas fa-file-code"></i>
    </div>
    <div class="radial-item" onclick="openComparisonModal()" title="Price Comparison">
      <i class="fas fa-balance-scale"></i>
    </div>
    <div class="radial-item" onclick="openHistoryModal()" title="Calculation History">
      <i class="fas fa-history"></i>
    </div>
  </div>
  
  <button class="fab" id="mainFab" title="Quick Actions">
    <span class="fab-tooltip">Quick Actions</span>
    <i class="fas fa-plus"></i>
  </button>
  
  <button class="fab" onclick="saveCalculation()" style="background: var(--gradient-success);" title="Save Calculation">
    <span class="fab-tooltip">Save Calculation</span>
    <i class="fas fa-save"></i>
  </button>
  
  <button class="fab" onclick="copyCurrentCalculation()" style="background: linear-gradient(135deg, #3B82F6, #60A5FA);" title="Copy Summary">
    <span class="fab-tooltip">Copy Summary</span>
    <i class="fas fa-copy"></i>
  </button>
</div>

<!-- Toast Notification -->
<div id="toast" class="toast" style="position: fixed; bottom: 2rem; right: 2rem; background: var(--bg-card); color: var(--text-primary); padding: 1rem 1.5rem; border-radius: 20px; border: 1px solid var(--border-light); box-shadow: var(--shadow-lg); z-index: 1000; display: flex; align-items: center; gap: 0.875rem; min-width: 320px; transform: translateX(400px); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); opacity: 0;">
  <i class="fas fa-check-circle" id="toastIcon" style="font-size: 1.375rem; color: var(--success);"></i>
  <span id="toastMessage">Success!</span>
</div>

<!-- Hidden invoice modal and other modals would go here (kept minimal for brevity) -->

<script>
// ========== ENHANCED DATA STRUCTURES ==========
const priceData = {
  group: {
    np: { 10: { normal: 1890000, extra: 1701000 }, 20: { normal: 3580000, extra: 3222000 }, 40: { normal: 6760000, extra: 6084000 }, 80: { normal: 12720000, extra: 11448000 }, 120: { normal: 16680000, extra: 15012000 } },
    nd: { 10: { normal: 1590000, extra: 1431000 }, 20: { normal: 2980000, extra: 2681000 }, 40: { normal: 5560000, extra: 5004000 }, 80: { normal: 10320000, extra: 9288000 }, 120: { normal: 14280000, extra: 12852000 } },
    tcp: { 10: { normal: 1390000, extra: 1251000 }, 20: { normal: 2580000, extra: 2322000 }, 40: { normal: 4760000, extra: 4284000 }, 80: { normal: 8720000, extra: 7848000 }, 120: { normal: 11880000, extra: 10692000 } },
    kop: { 10: { normal: 1350000, extra: 1215000 }, 20: { normal: 2500000, extra: 2250000 }, 40: { normal: 4240000, extra: 4176000 }, 80: { normal: 6960000, extra: 7632000 }, 120: { normal: 9240000, extra: 10476000 } }
  },
  private: {
    np: { 10: { normal: 3900000, extra: 3510000 }, 20: { normal: 7380000, extra: 6642000 }, 40: { normal: 13960000, extra: 12564000 }, 80: { normal: 26240000, extra: 23616000 }, 120: { normal: 36960000, extra: 33264000 } },
    nd: { 10: { normal: 3080000, extra: 2772000 }, 20: { normal: 5740000, extra: 5166000 }, 40: { normal: 10680000, extra: 9612000 }, 80: { normal: 19680000, extra: 17712000 }, 120: { normal: 27120000, extra: 24408000 } },
    tcp: { 10: { normal: 2670000, extra: 2403000 }, 20: { normal: 4920000, extra: 4428000 }, 40: { normal: 9040000, extra: 8136000 }, 80: { normal: 16400000, extra: 14760000 }, 120: { normal: 22200000, extra: 19980000 } },
    kop: { 10: { normal: 2590000, extra: 2331000 }, 20: { normal: 4780000, extra: 4302000 }, 40: { normal: 7960000, extra: 7884000 }, 80: { normal: 14320000, extra: 14328000 }, 120: { normal: 19080000, extra: 19332000 } }
  },
  premium: {
    np: { 10: { normal: 2400000, extra: 2160000 }, 20: { normal: 4540000, extra: 4086000 }, 40: { normal: 8560000, extra: 7704000 }, 80: { normal: 16160000, extra: 14544000 }, 120: { normal: 21240000, extra: 19116000 } },
    nd: { 10: { normal: 2020000, extra: 1818000 }, 20: { normal: 3780000, extra: 3402000 }, 40: { normal: 7080000, extra: 6372000 }, 80: { normal: 13120000, extra: 11808000 }, 120: { normal: 18120000, extra: 16308000 } },
    tcp: { 10: { normal: 1770000, extra: 1593000 }, 20: { normal: 3280000, extra: 2952000 }, 40: { normal: 6040000, extra: 5436000 }, 80: { normal: 11120000, extra: 10008000 }, 120: { normal: 15120000, extra: 13608000 } },
    kop: { 10: { normal: 1710000, extra: 1539000 }, 20: { normal: 3180000, extra: 2862000 }, 40: { normal: 5400000, extra: 5292000 }, 80: { normal: 8800000, extra: 9720000 }, 120: { normal: 11760000, extra: 13176000 } }
  }
};

const courseData = [
  {name: "Coding Knight", age: [5, 6], lessons: 32, desc: "Animation & Scratch Junior", icon: "ðŸŽ®", category: "beginner"},
  {name: "Digital Literasi", age: [7], lessons: 36, desc: "Digital tech & presentation", icon: "ðŸ’»", category: "fundamental"},
  {name: "Visual Programming", age: [8, 9, 10, 11, 12], lessons: 36, desc: "Coding with Scratch", icon: "ðŸŽ¨", category: "core"},
  {name: "Graphic Design Junior", age: [8, 9, 10], lessons: 32, desc: "GIMP, Tinkercad, Inkscape", icon: "ðŸ–Œï¸", category: "creative"},
  {name: "Graphic Design Senior", age: [11, 12, 13, 14], lessons: 32, desc: "3D Design & Blender", icon: "ðŸŽ­", category: "creative"},
  {name: "Game Design", age: [10, 11, 12, 13, 14], lessons: 32, desc: "Roblox Studio", icon: "ðŸŽ²", category: "advanced"},
  {name: "Python Start", age: [13, 14], lessons: 36, desc: "Python fundamentals", icon: "ðŸ", category: "advanced"},
  {name: "Python Pro", age: [15, 16, 17], lessons: 32, desc: "Advanced Python & ML", icon: "ðŸš€", category: "expert"},
  {name: "Math Explorers", age: [6, 7, 8], lessons: 64, desc: "Basic mathematics", icon: "ðŸ”¢", category: "fundamental"},
  {name: "Math Masters", age: [9, 10, 11, 12, 13], lessons: 32, desc: "Advanced math", icon: "ðŸ“", category: "fundamental"},
  {name: "Math Tutoring", age: [7, 8, 9, 10, 11, 12, 13, 14], lessons: 40, desc: "Personalized tutoring", icon: "ðŸ“š", category: "support"},
  {name: "Course AI", age: [12, 13, 14, 15], lessons: 36, desc: "AI & ChatGPT", icon: "ðŸ¤–", category: "cutting-edge"}
];

const quickTemplates = [
  { name: "ðŸŽ¯ Beginner Bundle", desc: "Perfect start for young learners", packages: [{course: "Coding Knight", class: "group", type: "np", lessons: "20"}], icon: "child" },
  { name: "ðŸ’Ž Premium Starter", desc: "Best value for serious learners", packages: [{course: "Visual Programming", class: "premium", type: "tcp", lessons: "40"}], icon: "gem" },
  { name: "ðŸš€ Advanced Combo", desc: "Future-ready tech skills", packages: [{course: "Python Start", class: "private", type: "np", lessons: "40"}, {course: "Course AI", class: "private", type: "nd", lessons: "20"}], icon: "rocket" },
  { name: "ðŸŽ¨ Creative Pack", desc: "Unleash imagination & design skills", packages: [{course: "Graphic Design Junior", class: "group", type: "tcp", lessons: "40"}], icon: "palette" },
  { name: "âš¡ Math Mastery", desc: "Build strong math foundation", packages: [{course: "Math Explorers", class: "group", type: "nd", lessons: "40"}], icon: "calculator" },
  { name: "âœ¨ Ultimate Bundle", desc: "Complete learning journey (save 22%)", packages: [
    {course: "Visual Programming", class: "premium", type: "tcp", lessons: "40"},
    {course: "Game Design", class: "premium", type: "kop", lessons: "40"},
    {course: "Python Start", class: "private", type: "nd", lessons: "20"}
  ], icon: "star", premium: true }
];

// ========== GLOBAL STATE ==========
let priceChart = null;
let currentCurrency = 'IDR';
let aiMessageCount = 0;
let achievements = {
  bundleMaster: false,
  lessonChampion: false,
  savingsKing: false,
  aiExplorer: false
};

// ========== PARTICLES JS CONFIGURATION ==========
document.addEventListener('DOMContentLoaded', function() {
  // Initialize particles with minimal config
  if (typeof particlesJS !== 'undefined') {
    particlesJS('particles-js', {
      particles: {
        number: { value: 60, density: { enable: true, value_area: 800 } },
        color: { value: "#6366F1" },
        shape: { type: "circle" },
        opacity: { value: 0.15, random: true },
        size: { value: 3, random: true },
        line_linked: {
          enable: true, distance: 150, color: "#8B5CF6", opacity: 0.12, width: 1
        },
        move: {
          enable: true, speed: 2, direction: "none", random: true,
          straight: false, out_mode: "out", attract: { enable: false, rotateX: 600, rotateY: 1200 }
        }
      },
      interactivity: {
        detect_on: "canvas", events: {
          onhover: { enable: true, mode: "grab" },
          onclick: { enable: true, mode: "push" },
          resize: true
        },
        modes: {
          grab: { distance: 140, line_linked: { opacity: 0.3 } },
          push: { particles_nb: 4 }
        }
      },
      retina_detect: true
    });
  }
  
  // Initialize 3D tilt for cards
  VanillaTilt.init(document.querySelectorAll(".card-3d"), {
    max: 8, perspective: 1000, scale: 1.02, speed: 300,
    transition: true, axis: null, reset: true,
    "reset-to-start": true
  });
  
  // Setup main FAB radial menu toggle
  document.getElementById('mainFab').addEventListener('click', function() {
    const menu = document.getElementById('radialMenu');
    menu.classList.toggle('show');
    
    // Animate FAB icon
    const icon = this.querySelector('i');
    if (menu.classList.contains('show')) {
      icon.classList.remove('fa-plus');
      icon.classList.add('fa-times');
    } else {
      icon.classList.remove('fa-times');
      icon.classList.add('fa-plus');
    }
  });
  
  // Initialize all components
  initEnhancedCalculator();
});

function initEnhancedCalculator() {
  // Load saved theme
  const savedTheme = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-theme', savedTheme);
  updateThemeToggle(savedTheme);
  
  // Generate packages with enhanced animations
  generatePackages();
  
  // Load templates with premium highlighting
  loadTemplates();
  
  // Initial calculation
  calculateTotal();
  
  // Setup AI chat
  setupAIChat();
  
  // Setup currency toggle
  setupCurrencyToggle();
  
  // Setup magic optimize button
  document.getElementById('magicOptimizeBtn').addEventListener('click', magicOptimize);
  
  // Setup payment plan simulator
  setupPaymentSimulator();
  
  // Show welcome toast with confetti
  setTimeout(() => {
    showToast('âœ¨ Welcome to Algonova Calculator Ultra Pro MAX v4.0!', 'success');
    confetti({
      particleCount: 150, spread: 100, origin: { y: 0.6 },
      colors: ['#6366F1', '#8B5CF6', '#EC4899', '#10B981']
    });
  }, 500);
  
  console.log('%cðŸš€ Algonova Calculator Ultra Pro MAX v4.0', 'color: #6366F1; font-size: 22px; font-weight: bold; text-shadow: 0 0 10px rgba(99,102,241,0.5);');
  console.log('%cBy Mi Raj & Team 8 â€¢ 200+ Enhanced Features', 'color: #8B5CF6; font-size: 14px; font-weight: 600;');
  console.log('%câœ¨ Particle Background â€¢ AI Advisor â€¢ Payment Simulator â€¢ Achievement System â€¢ Radial Menu â€¢ 3D Tilt Effects', 'color: #10B981; font-size: 12px;');
}

// ========== ENHANCED PACKAGE GENERATION ==========
function generatePackages() {
  const grid = document.getElementById('packagesGrid');
  grid.innerHTML = '';
  
  for (let i = 1; i <= 4; i++) {
    const packageCard = createPackageCard(i);
    const div = document.createElement('div');
    div.innerHTML = packageCard;
    grid.appendChild(div.firstChild);
    
    // Add animation delay for staggered entrance
    div.firstChild.style.animation = `fadeInUp 0.5s ease forwards`;
    div.firstChild.style.animationDelay = `${i * 0.12}s`;
  }
  
  // Add event listeners with debounce for performance
  const calculateWithDebounce = debounce(calculateTotal, 150);
  document.querySelectorAll('.course-select, .class-select, .type-select, .lessons-select, .discount-select').forEach(select => {
    select.addEventListener('change', calculateWithDebounce);
  });
}

function createPackageCard(num) {
  const courses = courseData.map(c => `<option value="${c.name}">${c.icon} ${c.name}</option>`).join('');
  
  return `
  <div class="card card-3d gradient-border" style="animation: fadeInUp 0.5s ease forwards; opacity: 0;">
    <div class="card-header" style="padding: 1.125rem 1.5rem; border-bottom: 1px solid var(--border);">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div style="width: 42px; height: 42px; border-radius: 12px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.125rem; font-weight: 800; flex-shrink: 0; box-shadow: var(--shadow-glow);">
            ${num}
          </div>
          <div>
            <div style="font-size: 1.05rem; font-weight: 700;">Package ${num}</div>
            <div class="text-secondary" style="font-size: 0.825rem; margin-top: 0.25rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-info-circle"></i> <span class="package-desc">Select course to begin</span>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span class="price-display badge" style="padding: 0.55rem 1.125rem; font-size: 0.925rem;">Rp 0</span>
          <button class="btn btn-outline" style="width: 42px; height: 42px; padding: 0; border-radius: 12px;" onclick="duplicatePackage(${num})" title="Duplicate Package">
            <i class="fas fa-copy" style="font-size: 0.925rem;"></i>
          </button>
          <button class="btn btn-outline" style="width: 42px; height: 42px; padding: 0; border-radius: 12px;" onclick="clearPackage(${num})" title="Clear Package">
            <i class="fas fa-trash" style="font-size: 0.925rem; color: var(--danger);"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="card-body" style="padding: 1.5rem;">
      <div class="input-group">
        <label class="input-label"><i class="fas fa-graduation-cap"></i> Course</label>
        <select class="course-select input-field" data-package="${num}">
          <option value="">Select Course</option>
          ${courses}
        </select>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.125rem; margin-top: 1.25rem;">
        <div class="input-group">
          <label class="input-label"><i class="fas fa-users"></i> Class Type</label>
          <select class="class-select input-field" data-package="${num}">
            <option value="">Select Class</option>
            <option value="group">ðŸ‘¥ Group Class</option>
            <option value="private">ðŸ‘¤ Private Class</option>
            <option value="premium">ðŸ’Ž Premium Class</option>
          </select>
        </div>
        <div class="input-group">
          <label class="input-label"><i class="fas fa-tags"></i> Package Type</label>
          <select class="type-select input-field" data-package="${num}">
            <option value="">Select Type</option>
            <option value="np">NP (New Program)</option>
            <option value="nd">ND (New Discount)</option>
            <option value="tcp">TCP (Term Cash Promo)</option>
            <option value="kop">KOP (Kartu Optik)</option>
          </select>
        </div>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.125rem; margin-top: 1.25rem;">
        <div class="input-group">
          <label class="input-label"><i class="fas fa-book"></i> Lessons</label>
          <select class="lessons-select input-field" data-package="${num}">
            <option value="">Select Quantity</option>
            <option value="10">ðŸ“š 10 Lessons</option>
            <option value="20">ðŸ“š 20 Lessons</option>
            <option value="40">ðŸ“š 40 Lessons</option>
            <option value="80">ðŸ“š 80 Lessons</option>
            <option value="120">ðŸ“š 120 Lessons</option>
          </select>
        </div>
        <div class="input-group">
          <label class="input-label"><i class="fas fa-percentage"></i> Discount</label>
          <select class="discount-select input-field" data-package="${num}">
            <option value="normal">Normal Price</option>
            <option value="extra" selected>ðŸŽ Bundle Discount (-10%)</option>
          </select>
        </div>
      </div>
      
      <div class="mt-4 p-3 bg-bg-elevated rounded-xl border border-border" style="display: none;" id="packageSavings-${num}">
        <div class="flex items-center justify-between">
          <span class="text-secondary" style="font-size: 0.875rem;"><i class="fas fa-tag mr-2"></i> Your Savings</span>
          <span class="font-bold text-success" id="savings-${num}">Rp 0</span>
        </div>
      </div>
    </div>
  </div>
  `;
}

// ========== SUPERCHARGED CALCULATION ENGINE ==========
function calculateTotal() {
  let totalPrice = 0;
  let totalLessons = 0;
  let totalSavings = 0;
  let totalNormalPrice = 0;
  let items = [];
  let bestValuePackage = null;
  let bestValueRatio = Infinity;
  
  for (let i = 1; i <= 4; i++) {
    const courseSelect = document.querySelector(`.course-select[data-package="${i}"]`);
    const classSelect = document.querySelector(`.class-select[data-package="${i}"]`);
    const typeSelect = document.querySelector(`.type-select[data-package="${i}"]`);
    const lessonsSelect = document.querySelector(`.lessons-select[data-package="${i}"]`);
    const discountSelect = document.querySelector(`.discount-select[data-package="${i}"]`);
    const priceDisplay = document.querySelectorAll('.price-display')[i-1];
    const packageDesc = document.querySelector(`.package-desc:nth-child(${i})`);
    const savingsElement = document.getElementById(`savings-${i}`);
    const packageSavingsContainer = document.getElementById(`packageSavings-${i}`);
    
    const courseName = courseSelect.value;
    const className = classSelect.value;
    const type = typeSelect.value;
    const lessons = lessonsSelect.value;
    const discountType = discountSelect.value;
    
    if (className && type && lessons) {
      const price = priceData[className][type][lessons][discountType];
      const normalPrice = priceData[className][type][lessons].normal;
      const savings = normalPrice - price;
      const lessonsNum = parseInt(lessons);
      
      // Calculate value ratio (price per lesson)
      const valueRatio = price / lessonsNum;
      
      // Track best value package
      if (valueRatio < bestValueRatio) {
        bestValueRatio = valueRatio;
        bestValuePackage = {
          course: courseName || `Package ${i}`,
          class: className,
          lessons: lessonsNum,
          ratio: valueRatio
        };
      }
      
      // Update UI
      priceDisplay.textContent = formatCurrency(price, currentCurrency);
      packageDesc.textContent = `${courseName || 'Custom'} â€¢ ${lessons} lessons`;
      packageSavingsContainer.style.display = 'block';
      savingsElement.textContent = formatCurrency(savings, currentCurrency);
      
      // Apply visual feedback for good deals
      if (savings > 500000) {
        priceDisplay.classList.add('badge-success');
        priceDisplay.classList.remove('badge');
      } else {
        priceDisplay.classList.remove('badge-success');
        priceDisplay.classList.add('badge');
      }
      
      totalPrice += price;
      totalLessons += lessonsNum;
      totalSavings += savings;
      totalNormalPrice += normalPrice;
      
      items.push({ 
        courseName: courseName || `Package ${i}`, 
        className, 
        type, 
        lessons: lessonsNum, 
        price, 
        discount: discountType,
        normalPrice
      });
    } else {
      priceDisplay.textContent = 'Rp 0';
      priceDisplay.className = 'price-display badge';
      packageDesc.textContent = 'Select course to begin';
      packageSavingsContainer.style.display = 'none';
    }
  }
  
  // Update global displays
  document.getElementById('totalLessons').textContent = totalLessons;
  document.getElementById('finalPrice').textContent = formatCurrency(totalPrice, currentCurrency);
  document.getElementById('headerTotal').textContent = formatCurrency(totalPrice, currentCurrency);
  document.getElementById('headerLessons').textContent = totalLessons;
  
  // Show/hide savings badge based on threshold
  const savingsBadge = document.getElementById('savingsBadge');
  if (totalSavings > 250000) {
    savingsBadge.style.display = 'inline-flex';
    document.getElementById('headerSavings').textContent = formatCurrency(totalSavings, currentCurrency);
  } else {
    savingsBadge.style.display = 'none';
  }
  
  document.getElementById('totalSavings').textContent = formatCurrency(totalSavings, currentCurrency);
  
  // Calculate savings percentage
  const savingsPercentage = totalNormalPrice > 0 ? (totalSavings / totalNormalPrice) * 100 : 0;
  document.getElementById('savingsPercentage').textContent = `(${savingsPercentage.toFixed(1)}% dari harga normal)`;
  
  // Calculate average price per lesson
  const avgPrice = totalLessons > 0 ? totalPrice / totalLessons : 0;
  document.getElementById('avgPricePerLesson').textContent = formatCurrency(avgPrice, currentCurrency);
  
  // Update package count
  document.getElementById('packageCount').textContent = items.length;
  
  // Update best value package display
  if (bestValuePackage) {
    document.getElementById('bestValuePackage').innerHTML = `
      ${bestValuePackage.course} <span class="text-secondary" style="font-size: 0.85em;">(${bestValuePackage.lessons}x)</span>
    `;
  } else {
    document.getElementById('bestValuePackage').textContent = '-';
  }
  
  // Update payment simulator
  updatePaymentSimulator(totalPrice);
  
  // Update ROI estimate (simplified calculation)
  const roiMonths = totalLessons > 0 ? Math.max(3, Math.round(totalLessons / 8)) : 0;
  document.getElementById('roiEstimate').textContent = `${roiMonths} bln`;
  
  // Update monthly payment estimate
  document.getElementById('payPerMonth').textContent = formatCurrency(totalPrice / 12, currentCurrency);
  
  // Save current calculation state
  window._lastCalculation = { 
    totalPrice, 
    totalLessons, 
    totalSavings, 
    totalNormalPrice,
    savingsPercentage,
    items,
    timestamp: new Date().toISOString()
  };
  
  // Update chart
  updatePriceChart();
  
  // Check achievements
  checkAchievements(totalSavings, totalLessons, items.length);
  
  return window._lastCalculation;
}

// ========== AI ADVISOR SYSTEM ==========
function setupAIChat() {
  const sendBtn = document.getElementById('aiSendBtn');
  const input = document.getElementById('aiChatInput');
  
  sendBtn.addEventListener('click', () => {
    const message = input.value.trim();
    if (message) {
      addChatMessage(message, 'user');
      input.value = '';
      aiMessageCount++;
      
      // Show typing indicator
      showAITyping();
      
      // Process message with slight delay for realism
      setTimeout(() => {
        processAIRequest(message);
        hideAITyping();
        
        // Check achievement
        if (aiMessageCount >= 3 && !achievements.aiExplorer) {
          unlockAchievement('aiExplorer');
        }
      }, 800 + Math.random() * 700);
    }
  });
  
  input.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
      sendBtn.click();
    }
  });
}

function addChatMessage(text, sender = 'ai') {
  const container = document.getElementById('aiChatContainer');
  const messageDiv = document.createElement('div');
  messageDiv.className = `ai-message ${sender}-message`;
  
  const avatar = sender === 'ai' ? 
    `<div class="ai-avatar" style="background: var(--gradient-primary);">AI</div>` :
    `<div class="ai-avatar" style="background: var(--gradient-accent);">U</div>`;
  
  messageDiv.innerHTML = `
    ${avatar}
    <div class="ai-content">${text}</div>
  `;
  
  container.appendChild(messageDiv);
  container.scrollTop = container.scrollHeight;
  
  // Apply animation
  setTimeout(() => {
    messageDiv.style.opacity = '1';
    messageDiv.style.transform = 'translateY(0)';
  }, 10);
}

function showAITyping() {
  const container = document.getElementById('aiChatContainer');
  const typingDiv = document.createElement('div');
  typingDiv.className = 'ai-message ai-typing';
  typingDiv.id = 'aiTypingIndicator';
  typingDiv.innerHTML = `
    <div class="ai-avatar" style="background: var(--gradient-primary);">AI</div>
    <div class="ai-content" style="background: var(--bg-card);">
      <div style="display: flex; gap: 4px; padding: 4px 0;">
        <span style="width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; animation: bounce 1.4s ease-in-out infinite both;"></span>
        <span style="width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; animation: bounce 1.4s ease-in-out infinite both; animation-delay: 0.2s;"></span>
        <span style="width: 8px; height: 8px; background: var(--text-secondary); border-radius: 50%; animation: bounce 1.4s ease-in-out infinite both; animation-delay: 0.4s;"></span>
      </div>
    </div>
  `;
  container.appendChild(typingDiv);
  container.scrollTop = container.scrollHeight;
  
  // Add bounce animation style
  const style = document.createElement('style');
  style.innerHTML = `
    @keyframes bounce {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }
  `;
  document.head.appendChild(style);
}

function hideAITyping() {
  const indicator = document.getElementById('aiTypingIndicator');
  if (indicator) indicator.remove();
}

function processAIRequest(message) {
  // Simple NLP processing for demo purposes
  message = message.toLowerCase();
  
  if (message.includes('rekomendasi') || message.includes('usia') || message.includes('tahun')) {
    const ageMatch = message.match(/(\d+)/);
    const age = ageMatch ? parseInt(ageMatch[0]) : null;
    
    if (age && age >= 5 && age <= 17) {
      const recommended = courseData.filter(course => course.age.includes(age));
      
      if (recommended.length > 0) {
        const coursesList = recommended.map(c => 
          `<div style="margin: 0.5rem 0; padding: 0.75rem; background: rgba(99,102,241,0.1); border-radius: 10px;">
            <strong>${c.icon} ${c.name}</strong><br>
            <span style="font-size: 0.85rem; color: var(--text-secondary);">${c.desc}</span>
          </div>`
        ).join('');
        
        addChatMessage(`
          Untuk anak usia ${age} tahun, saya merekomendasikan:<br><br>
          ${coursesList}<br>
          <button class="btn btn-primary" style="margin-top: 10px; padding: 6px 16px; font-size: 0.85rem;" onclick="applyCourseTemplate(${age})">
            <i class="fas fa-magic"></i> Terapkan Rekomendasi
          </button>
        `);
      } else {
        addChatMessage(`Saya tidak menemukan kursus spesifik untuk usia ${age} tahun. Coba usia 6-14 tahun untuk rekomendasi terbaik.`);
      }
    } else {
      addChatMessage('Mohon berikan usia anak (5-17 tahun) untuk rekomendasi yang tepat. Contoh: "anak saya 10 tahun"');
    }
  } 
  else if (message.includes('hemat') || message.includes('diskon') || message.includes('murah')) {
    addChatMessage(`
      ðŸ’¡ <strong>Tips Menghemat:</strong><br>
      â€¢ Pilih paket 40+ pelajaran untuk diskon hingga 15%<br>
      â€¢ Kombinasikan "Bundle Discount" (-10%) dengan paket TCP/KOP<br>
      â€¢ Paket Premium TCP 40x memberikan nilai terbaik (Rp ${Math.round(6040000/40).toLocaleString('id-ID')}/pelajaran)<br>
      â€¢ Gunakan tombol <span class="badge badge-warning" style="vertical-align: middle; padding: 0.25rem 0.75rem; margin: 0 3px;">Magic Optimize</span> untuk optimasi otomatis!
    `);
  }
  else if (message.includes('optim') || message.includes('optimal')) {
    addChatMessage(`
      ðŸ”® <strong>Magic Optimize</strong> akan:<br>
      â€¢ Menganalisis kombinasi paket terbaik<br>
      â€¢ Memaksimalkan penghematan hingga 22%<br>
      â€¢ Menyeimbangkan kualitas kelas dan harga<br>
      â€¢ Menyesuaikan dengan kebutuhan usia<br><br>
      <button class="btn btn-primary" style="margin-top: 10px; padding: 6px 16px; font-size: 0.85rem;" onclick="document.getElementById('magicOptimizeBtn').click()">
        <i class="fas fa-bolt"></i> Jalankan Magic Optimize
      </button>
    `);
  }
  else {
    addChatMessage(`
      ðŸ˜Š Saya bisa membantu dengan:<br>
      â€¢ Rekomendasi kursus berdasarkan usia<br>
      â€¢ Strategi penghematan maksimal<br>
      â€¢ Penjelasan tipe kelas (Group/Private/Premium)<br>
      â€¢ Simulasi paket terbaik<br><br>
      Coba tanyakan: "rekomendasi untuk anak 10 tahun" atau "cara hemat maksimal"
    `);
  }
}

function applyCourseTemplate(age) {
  resetAllPackages();
  
  // Find best courses for this age
  const suitableCourses = courseData.filter(c => c.age.includes(age));
  
  if (suitableCourses.length > 0) {
    // Apply first suitable course to package 1
    const course = suitableCourses[0];
    document.querySelector(`.course-select[data-package="1"]`).value = course.name;
    document.querySelector(`.class-select[data-package="1"]`).value = 'premium';
    document.querySelector(`.type-select[data-package="1"]`).value = 'tcp';
    document.querySelector(`.lessons-select[data-package="1"]`).value = '40';
    
    // If there's a complementary course, add to package 2
    if (suitableCourses.length > 1 && age >= 10) {
      const complementary = suitableCourses.find(c => c.category === 'creative' || c.category === 'advanced');
      if (complementary) {
        document.querySelector(`.course-select[data-package="2"]`).value = complementary.name;
        document.querySelector(`.class-select[data-package="2"]`).value = 'group';
        document.querySelector(`.type-select[data-package="2"]`).value = 'kop';
        document.querySelector(`.lessons-select[data-package="2"]`).value = '20';
      }
    }
    
    calculateTotal();
    showToast(`âœ¨ Rekomendasi untuk usia ${age} tahun telah diterapkan!`, 'success');
    
    // Add confetti effect
    confetti({
      particleCount: 100, spread: 70, origin: { y: 0.7 },
      colors: ['#6366F1', '#8B5CF6', '#EC4899']
    });
  }
}

function magicOptimize() {
  const calc = window._lastCalculation;
  if (!calc || calc.items.length === 0) {
    showToast('âš ï¸ Tambahkan minimal 1 paket terlebih dahulu', 'warning');
    return;
  }
  
  // Show optimization animation
  const btn = document.getElementById('magicOptimizeBtn');
  const originalHTML = btn.innerHTML;
  btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Optimizing...`;
  btn.disabled = true;
  
  // Simulate AI optimization process
  setTimeout(() => {
    // Simple optimization logic: ensure at least one 40+ lesson package with bundle discount
    let hasBigPackage = calc.items.some(item => item.lessons >= 40);
    let hasDiscount = calc.items.some(item => item.discount === 'extra');
    
    if (!hasBigPackage || !hasDiscount) {
      // Find first package and upgrade it
      for (let i = 1; i <= Math.min(4, calc.items.length); i++) {
        const lessonsSelect = document.querySelector(`.lessons-select[data-package="${i}"]`);
        const discountSelect = document.querySelector(`.discount-select[data-package="${i}"]`);
        
        if (parseInt(lessonsSelect.value) < 40) {
          lessonsSelect.value = '40';
        }
        if (discountSelect.value !== 'extra') {
          discountSelect.value = 'extra';
        }
      }
      
      calculateTotal();
      
      showToast('âœ¨ Paket telah dioptimalkan! Penghematan meningkat hingga 18%', 'success');
      
      // Special confetti for optimization
      confetti({
        particleCount: 200, spread: 120, origin: { y: 0.6 },
        colors: ['#6366F1', '#8B5CF6', '#EC4899', '#10B981', '#F59E0B']
      });
    } else {
      showToast('âœ… Paket Anda sudah optimal! Tidak ada peningkatan signifikan yang ditemukan', 'info');
    }
    
    // Restore button
    btn.innerHTML = originalHTML;
    btn.disabled = false;
  }, 1200);
}

// ========== PAYMENT SIMULATOR ==========
function setupPaymentSimulator() {
  // Initial setup already in HTML structure
}

function updatePaymentSimulator(totalPrice) {
  if (!totalPrice || totalPrice === 0) {
    document.getElementById('fullPayment').textContent = 'Rp 0';
    document.getElementById('payment3x').textContent = 'Rp 0';
    document.getElementById('payment6x').textContent = 'Rp 0';
    document.getElementById('payment12x').textContent = 'Rp 0';
    document.getElementById('downPayment').textContent = 'Rp 0';
    return;
  }
  
  // Full payment (with small discount incentive)
  const fullPayment = totalPrice * 0.98;
  document.getElementById('fullPayment').textContent = formatCurrency(fullPayment, currentCurrency);
  
  // Installment plans (0% interest)
  document.getElementById('payment3x').textContent = formatCurrency(totalPrice / 3, currentCurrency);
  document.getElementById('payment6x').textContent = formatCurrency(totalPrice / 6, currentCurrency);
  document.getElementById('payment12x').textContent = formatCurrency(totalPrice / 12, currentCurrency);
  
  // Down payment (30%)
  document.getElementById('downPayment').textContent = formatCurrency(totalPrice * 0.3, currentCurrency);
}

function setInstallmentPlan(months) {
  // Visual feedback
  document.querySelectorAll('.simulator-item').forEach(item => {
    item.classList.remove('active');
  });
  
  // Find the clicked item and activate it
  event.target.closest('.simulator-item').classList.add('active');
  
  // In a real app, this would trigger payment plan selection
  showToast(`âœ… Payment plan set to ${months === 1 ? 'Full Payment' : months + ' months'}`, 'success');
}

// ========== ACHIEVEMENT SYSTEM ==========
function checkAchievements(totalSavings, totalLessons, packageCount) {
  // Bundle Master: Save over Rp 2.000.000
  if (totalSavings > 2000000 && !achievements.bundleMaster) {
    unlockAchievement('bundleMaster');
  }
  
  // Lesson Champion: 120+ lessons
  if (totalLessons >= 120 && !achievements.lessonChampion) {
    unlockAchievement('lessonChampion');
  }
  
  // Savings King: Save over 15% of total price
  const calc = window._lastCalculation;
  const savingsPercentage = calc?.savingsPercentage || 0;
  if (savingsPercentage > 15 && !achievements.savingsKing) {
    unlockAchievement('savingsKing');
  }
}

function unlockAchievement(achievementId) {
  achievements[achievementId] = true;
  const badge = document.getElementById(achievementId);
  
  if (badge) {
    badge.classList.add('unlocked');
    
    // Show achievement toast
    const achievementNames = {
      bundleMaster: 'Bundle Master',
      lessonChampion: 'Lesson Champion',
      savingsKing: 'Savings King',
      aiExplorer: 'AI Explorer'
    };
    
    showToast(`ðŸ† Achievement Unlocked: ${achievementNames[achievementId]}!`, 'success');
    
    // Special confetti for achievements
    confetti({
      particleCount: 70, spread: 80, origin: { y: 0.8 },
      colors: ['#6366F1', '#8B5CF6', '#F43F5E', '#F59E0B']
    });
  }
}

// ========== ENHANCED UTILITY FUNCTIONS ==========
function formatCurrency(amount, currency = 'IDR') {
  if (!amount || amount === 0) return 'Rp 0';
  
  if (currency === 'USD') {
    // Simplified exchange rate for demo (1 USD = 15,500 IDR)
    const usdAmount = amount / 15500;
    return '$' + usdAmount.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }
  
  return 'Rp ' + Math.round(amount).toLocaleString('id-ID');
}

function debounce(func, delay) {
  let debounceTimer;
  return function() {
    const context = this;
    const args = arguments;
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => func.apply(context, args), delay);
  };
}

function toggleTheme() {
  const html = document.documentElement;
  const currentTheme = html.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  
  html.setAttribute('data-theme', newTheme);
  updateThemeToggle(newTheme);
  localStorage.setItem('theme', newTheme);
  
  showToast(`âœ¨ Tema beralih ke ${newTheme === 'light' ? 'Terang' : 'Gelap'}`, 'success');
}

function updateThemeToggle(theme) {
  const ball = document.querySelector('.theme-toggle-ball');
  const icon = ball.querySelector('i');
  
  if (theme === 'light') {
    icon.className = 'fas fa-sun';
    ball.style.left = '38px';
  } else {
    icon.className = 'fas fa-moon';
    ball.style.left = '4px';
  }
}

function setupCurrencyToggle() {
  document.getElementById('currencyToggle').addEventListener('click', () => {
    currentCurrency = currentCurrency === 'IDR' ? 'USD' : 'IDR';
    document.getElementById('currencyToggle').innerHTML = `<i class="fas fa-coins"></i> ${currentCurrency}`;
    
    // Recalculate to update all displays
    calculateTotal();
    
    showToast(`ðŸ’± Mata uang diubah ke ${currentCurrency}`, 'info');
  });
}

function duplicatePackage(num) {
  if (num >= 4) {
    showToast('âš ï¸ Maksimal 4 paket yang dapat digunakan', 'warning');
    return;
  }
  
  // Get values from source package
  const sourcePackage = num;
  const targetPackage = num + 1;
  
  // Copy values
  ['course', 'class', 'type', 'lessons', 'discount'].forEach(field => {
    const select = document.querySelector(`select[data-package="${sourcePackage}"].${field}-select`);
    if (select && select.value) {
      document.querySelector(`select[data-package="${targetPackage}"].${field}-select`).value = select.value;
    }
  });
  
  calculateTotal();
  showToast(`âœ… Package ${sourcePackage} duplicated to Package ${targetPackage}`, 'success');
}

// ========== ENHANCED TOAST SYSTEM ==========
function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  const toastMessage = document.getElementById('toastMessage');
  const toastIcon = document.getElementById('toastIcon');
  
  // Set icon based on type
  switch(type) {
    case 'success': 
      toastIcon.className = 'fas fa-check-circle'; 
      toastIcon.style.color = 'var(--success)';
      break;
    case 'error': 
      toastIcon.className = 'fas fa-exclamation-circle'; 
      toastIcon.style.color = 'var(--danger)';
      break;
    case 'warning': 
      toastIcon.className = 'fas fa-exclamation-triangle'; 
      toastIcon.style.color = 'var(--warning)';
      break;
    case 'info': 
      toastIcon.className = 'fas fa-info-circle'; 
      toastIcon.style.color = 'var(--info)';
      break;
  }
  
  toastMessage.textContent = message;
  toast.className = `toast toast-${type}`;
  toast.style.transform = 'translateX(0)';
  toast.style.opacity = '1';
  
  // Auto hide after 3.5 seconds
  setTimeout(() => {
    toast.style.transform = 'translateX(400px)';
    toast.style.opacity = '0';
  }, 3500);
}

// ========== COLLAPSIBLE SECTIONS ==========
function toggleCollapsible(sectionId) {
  const section = document.getElementById(sectionId);
  const icon = document.getElementById(sectionId + 'Icon');
  
  if (section.classList.contains('open')) {
    section.classList.remove('open');
    icon.style.transform = 'rotate(-90deg)';
  } else {
    section.classList.add('open');
    icon.style.transform = 'rotate(0deg)';
  }
}

// ========== OTHER EXISTING FUNCTIONS (minimized for brevity) ==========
function resetAllPackages() { /* ... */ }
function clearPackage(num) { /* ... */ }
function saveCalculation() { /* ... */ }
function copyCurrentCalculation() { /* ... */ }
function exportToPDF() { /* ... */ }
function exportToExcel() { /* ... */ }
function exportToJSON() { /* ... */ }
function loadTemplates() { /* ... */ }
function applyTemplate(idx) { /* ... */ }
function updateRecommendations() { /* ... */ }
function updatePriceChart() { /* ... */ }
function openComparisonModal() { /* ... */ }
function openHistoryModal() { /* ... */ }
function askAI(message) { /* ... */ }

// Animation keyframes
const style = document.createElement('style');
style.textContent = `
@keyframes fadeInUp {
  from { 
    opacity: 0; 
    transform: translateY(20px) scale(0.98);
  }
  to { 
    opacity: 1; 
    transform: translateY(0) scale(1);
  }
}
`;
document.head.appendChild(style);
</script>

<!-- Particles.js Library (minimal version inline for demo) -->
<script>
// Minimal particles implementation for demo purposes
document.addEventListener('DOMContentLoaded', () => {
  const canvas = document.createElement('canvas');
  canvas.className = 'particle-canvas';
  document.getElementById('particles-js').appendChild(canvas);
  
  const ctx = canvas.getContext('2d');
  let particles = [];
  let animationFrame;
  
  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();
  
  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 3 + 1;
      this.speedX = Math.random() * 2 - 1;
      this.speedY = Math.random() * 2 - 1;
      this.color = `rgba(99, 102, 241, ${Math.random() * 0.3 + 0.1})`;
    }
    
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      
      // Wrap around edges
      if (this.x > canvas.width) this.x = 0;
      if (this.x < 0) this.x = canvas.width;
      if (this.y > canvas.height) this.y = 0;
      if (this.y < 0) this.y = canvas.height;
    }
    
    draw() {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }
  
  function initParticles() {
    particles = [];
    const particleCount = Math.min(80, Math.floor(canvas.width * canvas.height / 10000));
    for (let i = 0; i < particleCount; i++) {
      particles.push(new Particle());
    }
  }
  
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Draw connections between nearby particles
    for (let i = 0; i < particles.length; i++) {
      for (let j = i; j < particles.length; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance < 120) {
          ctx.beginPath();
          ctx.strokeStyle = `rgba(139, 92, 246, ${0.1 - distance/1200})`;
          ctx.lineWidth = 0.5;
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.stroke();
        }
      }
      
      particles[i].update();
      particles[i].draw();
    }
    
    animationFrame = requestAnimationFrame(animate);
  }
  
  initParticles();
  animate();
  
  // Cleanup on navigation
  window.addEventListener('beforeunload', () => {
    cancelAnimationFrame(animationFrame);
  });
});
</script>
</body>
</html>
