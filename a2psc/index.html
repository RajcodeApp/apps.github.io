
<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Raj Sales Intelligence</title>
  <meta name="theme-color" content="#0B0F19">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Plus Jakarta Sans"', 'sans-serif'],
            mono: ['"JetBrains Mono"', 'monospace'],
          },
          colors: {
            background: '#050505',
            surface: '#0F1115',
            surfaceHighlight: '#1A1D24',
            primary: '#F59E0B', // Amber
            secondary: '#6366F1', // Indigo
          },
          animation: {
            'fade-in': 'fadeIn 0.4s ease-out forwards',
            'slide-up': 'slideUp 0.4s ease-out forwards',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            }
          }
        }
      }
    }
  </script>

  <style>
    /* Global Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }

    body {
      background-color: #050505;
      background-image: 
        radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.08), transparent 25%), 
        radial-gradient(circle at 85% 30%, rgba(245, 158, 11, 0.05), transparent 25%);
      min-height: 100vh;
    }

    /* Glass Components */
    .glass {
      background: rgba(20, 22, 27, 0.6);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .glass-high {
      background: rgba(30, 33, 40, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    /* Form Inputs */
    .input-modern {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.2s ease;
    }
    .input-modern:focus {
      background: rgba(0, 0, 0, 0.5);
      border-color: #F59E0B;
      box-shadow: 0 0 0 1px rgba(245, 158, 11, 0.3);
      outline: none;
    }

    /* Table Specifics */
    .table-row-hover:hover {
      background: linear-gradient(90deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
    }
    
    /* Line Clamp for Notes */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="text-slate-400 font-sans antialiased selection:bg-primary selection:text-black">

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-8 right-8 z-50 hidden transform transition-all duration-500 translate-y-10 opacity-0">
    <div class="glass rounded-xl p-4 flex items-center gap-4 shadow-2xl border-l-4 border-emerald-500 bg-[#0F1115]">
      <div class="bg-emerald-500/10 p-2 rounded-lg text-emerald-400">
        <span id="toastIcon" class="text-xl">‚úÖ</span>
      </div>
      <div>
        <h4 id="toastTitle" class="text-sm font-bold text-white">Notification</h4>
        <p id="toastMessage" class="text-xs text-slate-400 mt-0.5">Message here.</p>
      </div>
    </div>
  </div>

  <!-- Navbar -->
  <nav class="fixed w-full top-0 z-40 border-b border-white/5 bg-[#050505]/80 backdrop-blur-xl">
    <div class="max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Logo -->
        <div class="flex items-center gap-3">
          <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-lg shadow-orange-500/10 text-black font-bold text-lg">M</div>
          <div>
            <h1 class="text-white font-bold text-base tracking-tight">Mi Raj <span class="text-amber-500">Tracker</span></h1>
          </div>
        </div>

        <!-- Right Actions -->
        <div class="flex items-center gap-3">
          <div class="relative group">
            <button id="menuBtn" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 hover:bg-white/10 border border-white/5 text-xs font-medium text-white transition-all">
              <span>Menu Actions</span>
              <svg class="w-3 h-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            
            <!-- Dropdown -->
            <div id="menu" class="absolute right-0 mt-2 w-56 glass rounded-xl shadow-2xl py-2 hidden transform origin-top-right transition-all z-50 bg-[#0F1115]">
              <button id="importBtn" class="w-full text-left px-4 py-2.5 text-xs text-slate-300 hover:bg-white/5 hover:text-white flex items-center gap-3 transition-colors">
                <span class="text-blue-400">üì•</span> Import CSV
              </button>
              <button id="exportAllBtn" class="w-full text-left px-4 py-2.5 text-xs text-slate-300 hover:bg-white/5 hover:text-white flex items-center gap-3 transition-colors">
                <span class="text-emerald-400">üì§</span> Export All Data
              </button>
              <button id="targetBtn" class="w-full text-left px-4 py-2.5 text-xs text-slate-300 hover:bg-white/5 hover:text-white flex items-center gap-3 transition-colors">
                <span class="text-amber-400">üéØ</span> Set Monthly Target
              </button>
              <button id="chartBtn" class="w-full text-left px-4 py-2.5 text-xs text-slate-300 hover:bg-white/5 hover:text-white flex items-center gap-3 transition-colors">
                <span class="text-purple-400">üìä</span> Analytics Dashboard
              </button>
              <div class="h-px bg-white/5 my-1"></div>
              <button id="resetBtn" class="w-full text-left px-4 py-2.5 text-xs text-rose-500 hover:bg-rose-500/10 flex items-center gap-3 transition-colors">
                <span>üí•</span> Factory Reset
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Layout -->
  <main class="max-w-[1800px] mx-auto px-4 sm:px-6 lg:px-8 py-8 mt-16">
    
    <!-- 1. Stats Overview (Top) -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 animate-slide-up" style="animation-delay: 0.1s;">
      
      <!-- Revenue Card -->
      <div class="glass rounded-2xl p-5 relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/10 rounded-full blur-3xl -mr-10 -mt-10 group-hover:bg-emerald-500/20 transition-all duration-500"></div>
        <div class="relative z-10">
          <div class="flex justify-between items-start mb-2">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-500">Revenue</p>
            <span class="text-xs font-medium text-emerald-400 bg-emerald-500/10 px-2 py-0.5 rounded-full border border-emerald-500/10">Net</span>
          </div>
          <h3 id="statRevenue" class="text-2xl lg:text-3xl font-bold text-white tracking-tight">Rp 0</h3>
          <div class="mt-3 flex items-center gap-2">
             <div id="statRevChange" class="text-[10px] font-medium px-1.5 py-0.5 rounded bg-white/5 text-slate-400">vs prev month</div>
          </div>
        </div>
      </div>

      <!-- Performance Card -->
      <div class="glass rounded-2xl p-5 relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl -mr-10 -mt-10 group-hover:bg-blue-500/20 transition-all duration-500"></div>
        <div class="relative z-10">
           <p class="text-[10px] font-bold uppercase tracking-widest text-slate-500 mb-2">Conversion</p>
           <div class="flex items-baseline gap-3">
             <h3 id="statConversion" class="text-3xl font-bold text-white">0%</h3>
             <span class="text-xs text-slate-400">from <span id="statTcTotal" class="text-white font-bold">0</span> TCs</span>
           </div>
           <div class="mt-3 grid grid-cols-2 gap-2">
             <div class="bg-white/5 rounded p-1.5 text-center">
               <div class="text-[10px] text-slate-500">Sales</div>
               <div id="statSales" class="text-sm font-bold text-blue-400">0</div>
             </div>
             <div class="bg-white/5 rounded p-1.5 text-center">
               <div class="text-[10px] text-slate-500">Pending</div>
               <div id="statPending" class="text-sm font-bold text-amber-400">0</div>
             </div>
           </div>
        </div>
      </div>

      <!-- Bonus Estimator -->
      <div class="glass rounded-2xl p-5 relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-32 h-32 bg-pink-500/10 rounded-full blur-3xl -mr-10 -mt-10 group-hover:bg-pink-500/20 transition-all duration-500"></div>
        <div class="relative z-10">
          <div class="flex justify-between items-start mb-1">
            <p class="text-[10px] font-bold uppercase tracking-widest text-slate-500">Estimated Bonus</p>
            <span id="bonusLevel" class="text-[10px] font-bold bg-gradient-to-r from-purple-500 to-pink-600 text-white px-2 py-0.5 rounded shadow-lg shadow-purple-500/20">Lvl 1</span>
          </div>
          <h3 id="statBonus" class="text-2xl font-bold text-white mt-1">Rp 0</h3>
          
          <div class="w-full bg-slate-800 h-1.5 rounded-full mt-4 overflow-hidden">
            <div id="bonusBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 w-0 transition-all duration-1000 ease-out"></div>
          </div>
          <div class="flex justify-between mt-2 text-[10px]">
             <span class="text-slate-500">Rate: <span id="bonusPercent" class="text-white">0%</span></span>
             <span class="text-slate-500">TC Salary: <span id="statTcSalary" class="text-white">Rp 0</span></span>
          </div>
        </div>
      </div>

      <!-- Target Progress -->
      <div id="targetSection" class="glass rounded-2xl p-5 relative overflow-hidden flex flex-col justify-between hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-500 to-orange-500 opacity-50"></div>
        <div>
          <div class="flex justify-between items-end mb-1">
             <p class="text-[10px] font-bold uppercase tracking-widest text-amber-500">Monthly Goal</p>
             <p id="targetPercent" class="text-xl font-bold text-white">0%</p>
          </div>
          <div class="flex items-baseline gap-1">
            <h3 id="targetCurrent" class="text-lg font-bold text-slate-300">Rp 0</h3>
            <span class="text-xs text-slate-600">/ <span id="targetDesc">Rp 0</span></span>
          </div>
        </div>
        <div class="w-full bg-slate-800 h-2 rounded-full mt-3 overflow-hidden relative">
           <div id="targetProgress" class="h-full bg-amber-500 rounded-full relative transition-all duration-1000" style="width: 0%">
             <div class="absolute inset-0 bg-white/30 w-full h-full animate-[shimmer_2s_infinite]"></div>
           </div>
        </div>
        <p class="text-[10px] text-slate-500 mt-2 text-right">To go: <span id="targetRemaining" class="text-white">Rp 0</span></p>
      </div>
    </div>

    <!-- 2. Workspace Split (Left: Form/Filter, Right: Table) -->
    <div class="grid lg:grid-cols-12 gap-6 h-full animate-slide-up" style="animation-delay: 0.2s;">
      
      <!-- LEFT PANEL (Sticky) -->
      <div class="lg:col-span-3 flex flex-col gap-5 h-full">
        <div class="sticky top-24 space-y-5">
          
          <!-- Entry Form -->
          <div class="glass rounded-2xl p-5 border-t-4 border-t-amber-500">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-white text-sm flex items-center gap-2">
                <span id="formTitle">New Record</span>
              </h3>
              <button id="clearFormBtn" class="text-[10px] text-slate-500 hover:text-white transition-colors uppercase tracking-wider font-bold">Clear</button>
            </div>

            <form id="entryForm" class="space-y-3">
              <input type="hidden" id="editingId">
              
              <!-- Date & Time -->
              <div class="grid grid-cols-2 gap-2">
                 <div class="space-y-1">
                   <label class="text-[10px] uppercase text-slate-500 font-bold">Date</label>
                   <input id="date" type="date" required class="w-full input-modern rounded-lg px-3 py-2 text-xs text-white">
                 </div>
                 <div class="space-y-1">
                   <label class="text-[10px] uppercase text-slate-500 font-bold">Time</label>
                   <input id="time" type="time" class="w-full input-modern rounded-lg px-3 py-2 text-xs text-white">
                 </div>
              </div>

              <!-- Student -->
              <div class="space-y-1">
                 <label class="text-[10px] uppercase text-slate-500 font-bold">Student Name</label>
                 <input id="childName" type="text" placeholder="Name..." class="w-full input-modern rounded-lg px-3 py-2 text-sm text-white placeholder-slate-600">
              </div>

              <!-- CRM -->
               <div class="space-y-1">
                 <label class="text-[10px] uppercase text-slate-500 font-bold">CRM Link</label>
                 <input id="crm" type="url" placeholder="https://..." class="w-full input-modern rounded-lg px-3 py-2 text-xs text-blue-400 placeholder-slate-700">
              </div>

              <!-- Course & Status -->
              <div class="grid grid-cols-2 gap-2">
                 <div class="space-y-1">
                   <label class="text-[10px] uppercase text-slate-500 font-bold">Course</label>
                   <select id="course" required class="w-full input-modern rounded-lg px-2 py-2 text-xs text-white">
                     <option value="">Select...</option>
                      <option value="Coding Knight">Coding Knight</option>
                      <option value="Digital Literasi">Digital Literasi</option>
                      <option value="Visual Programming">Visual Programming</option>
                      <option value="Graphic Design Junior">GD Junior</option>
                      <option value="Graphic Design Senior">GD Senior</option>
                      <option value="Game Design">Game Design</option>
                      <option value="Python Start">Python Start</option>
                      <option value="Python Pro">Python Pro</option>
                      <option value="Math Explorers">Math Exp.</option>
                      <option value="Math Masters">Math Masters</option>
                      <option value="Course AI">Course AI</option>
                      <option value="Math Tutoring">Math Tutor</option>
                   </select>
                 </div>
                 <div class="space-y-1">
                   <label class="text-[10px] uppercase text-slate-500 font-bold">Status</label>
                   <select id="buyOrNot" required class="w-full input-modern rounded-lg px-2 py-2 text-xs text-white">
                     <option value="">Select...</option>
                     <option value="Buy">‚úÖ Buy</option>
                     <option value="Not">‚ùå Not Buy</option>
                     <option value="Pending">‚è≥ Pending</option>
                   </select>
                 </div>
              </div>

              <!-- Revenue & Layer -->
              <div class="grid grid-cols-2 gap-2">
                <div class="space-y-1">
                   <label class="text-[10px] uppercase text-slate-500 font-bold">Revenue</label>
                   <input id="revenue" type="number" placeholder="0" class="w-full input-modern rounded-lg px-3 py-2 text-xs text-emerald-400 font-mono placeholder-slate-700">
                 </div>
                 <div class="space-y-1">
                   <label class="text-[10px] uppercase text-slate-500 font-bold">Layer</label>
                   <select id="layer" class="w-full input-modern rounded-lg px-2 py-2 text-xs text-white">
                     <option value="">-</option>
                     <option value="TCP">TCP</option>
                     <option value="ND">ND</option>
                     <option value="PP">PP</option>
                     <option value="Other">Other</option>
                   </select>
                 </div>
              </div>

              <!-- Notes -->
              <div class="space-y-1">
                 <label class="text-[10px] uppercase text-slate-500 font-bold">Notes</label>
                 <textarea id="note" rows="3" placeholder="Add details here..." class="w-full input-modern rounded-lg px-3 py-2 text-xs text-white placeholder-slate-600 resize-none"></textarea>
              </div>

              <div class="pt-2 flex gap-2">
                <button type="submit" class="flex-1 bg-amber-500 hover:bg-amber-400 text-black font-bold py-2.5 rounded-lg shadow-lg shadow-amber-500/20 transition-all transform hover:-translate-y-0.5 text-sm">
                  Save
                </button>
                <button type="button" id="duplicateBtn" class="hidden px-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors" title="Duplicate">
                   üìã
                </button>
              </div>
            </form>
          </div>

          <!-- Filters Mini -->
          <div class="glass rounded-2xl p-5">
            <div class="flex items-center justify-between mb-3">
              <h3 class="font-bold text-slate-400 text-xs uppercase tracking-wider">Filters</h3>
              <button id="refreshBtn" class="text-amber-500 hover:text-amber-400 text-xs font-bold">Refresh</button>
            </div>
            <div class="space-y-2.5">
              <input id="searchInput" type="text" placeholder="Search..." class="w-full input-modern rounded-lg px-3 py-2 text-xs text-white">
              <div class="grid grid-cols-2 gap-2">
                <select id="monthSelector" class="input-modern rounded-lg px-2 py-2 text-xs text-slate-300"></select>
                <select id="periodFilter" class="input-modern rounded-lg px-2 py-2 text-xs text-slate-300">
                  <option value="">All Time</option>
                  <option value="P1">P1 (1-15)</option>
                  <option value="P2">P2 (16-31)</option>
                </select>
              </div>
              <select id="courseFilter" class="w-full input-modern rounded-lg px-2 py-2 text-xs text-slate-300">
                <option value="">All Courses</option>
              </select>
              <div class="flex justify-between text-[10px] text-slate-500 pt-1">
                <span id="recordCount">0 records</span>
                <button id="exportCurrentBtn" class="hover:text-white">Exp. CSV</button>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT PANEL (Table) -->
      <div class="lg:col-span-9 flex flex-col h-full min-h-[600px]">
        <div class="glass rounded-2xl flex-1 flex flex-col overflow-hidden relative">
          
          <!-- Table Header & Bulk Actions -->
          <div class="p-4 border-b border-white/5 flex justify-between items-center bg-[#0F1115]/50">
            <div class="flex items-center gap-3">
               <h2 class="text-white font-bold text-sm">Data Log</h2>
               <div class="h-4 w-px bg-white/10"></div>
               <span id="selectedMonth" class="text-xs text-amber-500 font-mono"></span>
            </div>
            <button id="bulkDeleteBtn" class="hidden items-center gap-2 px-3 py-1 bg-rose-500/10 text-rose-500 border border-rose-500/20 hover:bg-rose-500/20 rounded text-xs font-bold transition-all">
              Delete Selected (<span id="selectedCount">0</span>)
            </button>
          </div>

          <!-- Table Container -->
          <div class="overflow-auto flex-1 w-full">
             <!-- Empty State -->
            <div id="emptyState" class="hidden absolute inset-0 flex flex-col items-center justify-center text-center p-8 z-10 bg-[#0B0F19]/80 backdrop-blur-sm">
              <div class="w-16 h-16 bg-slate-800/50 rounded-full flex items-center justify-center mb-4">
                <span class="text-3xl">üì≠</span>
              </div>
              <h3 class="text-slate-300 font-bold mb-1">No Records Found</h3>
              <p class="text-slate-500 text-xs max-w-xs mx-auto">Try adjusting your filters or use the form on the left to add new data.</p>
            </div>

            <table class="w-full text-left border-collapse">
              <thead class="bg-[#0F1115] text-[10px] text-slate-500 uppercase font-bold tracking-wider sticky top-0 z-20 shadow-sm">
                <tr>
                  <th class="p-4 w-10"><input type="checkbox" id="selectAll" class="rounded border-slate-700 bg-transparent text-amber-500 focus:ring-0 cursor-pointer"></th>
                  <th class="p-4 cursor-pointer hover:text-white transition-colors" data-sort="date">Date ‚Üï</th>
                  <th class="p-4">Student / CRM</th>
                  <th class="p-4">Course</th>
                  <th class="p-4 cursor-pointer hover:text-white transition-colors" data-sort="buyOrNot">Status ‚Üï</th>
                  <th class="p-4 cursor-pointer hover:text-white transition-colors" data-sort="revenue">Revenue ‚Üï</th>
                  <!-- KOLOM NOTES BARU -->
                  <th class="p-4 w-1/5">Notes</th> 
                  <th class="p-4 text-right">Action</th>
                </tr>
              </thead>
              <tbody id="tbody" class="text-sm text-slate-300 divide-y divide-white/5">
                <!-- JS will inject rows here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- MODALS -->
  
  <!-- Backdrop -->
  <div id="modalBackdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden transition-opacity"></div>

  <!-- Chart Modal -->
  <div id="chartModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
    <div class="w-full max-w-4xl bg-[#0F1115] border border-white/10 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] animate-slide-up">
      <div class="p-5 border-b border-white/5 flex justify-between items-center bg-[#15181E]">
        <h3 class="text-white font-bold">Analytics Dashboard</h3>
        <button id="closeChartBtn" class="text-slate-500 hover:text-white">‚úï</button>
      </div>
      <div class="p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-2 gap-6">
         <div class="glass p-5 rounded-xl border border-white/5">
           <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-4 tracking-widest">Status Distribution</h4>
           <div id="statusChart" class="h-40 flex items-end gap-2 px-2"></div>
         </div>
         <div class="glass p-5 rounded-xl border border-white/5 md:col-span-2">
           <h4 class="text-[10px] font-bold text-slate-500 uppercase mb-4 tracking-widest">Course Popularity</h4>
           <div id="courseBreakdown" class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-3"></div>
         </div>
      </div>
    </div>
  </div>

  <!-- Target Modal -->
  <div id="targetModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-[#0F1115] border border-amber-500/30 rounded-2xl shadow-2xl p-6 animate-slide-up">
       <h3 class="text-lg font-bold text-white mb-1">üéØ Monthly Target</h3>
       <p class="text-xs text-slate-500 mb-4">Set your revenue goal for the selected month.</p>
       
       <div class="relative mb-6">
         <span class="absolute left-3 top-3 text-slate-500 font-mono">Rp</span>
         <input id="targetInput" type="number" class="w-full bg-black/50 border border-white/10 rounded-xl p-3 pl-10 text-xl font-bold text-white focus:border-amber-500 outline-none" placeholder="50000000">
       </div>
       
       <div class="flex justify-end gap-3">
         <button id="cancelTargetBtn" class="px-4 py-2 text-slate-400 hover:text-white text-sm">Cancel</button>
         <button id="saveTargetBtn" class="px-4 py-2 bg-amber-500 hover:bg-amber-400 text-black font-bold rounded-lg text-sm shadow-lg shadow-amber-500/20">Save Target</button>
       </div>
    </div>
  </div>

  <!-- Reset Password Modal -->
  <div id="pwModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
    <div class="w-full max-w-sm bg-[#0F1115] border border-rose-500/30 rounded-2xl shadow-2xl p-6 animate-slide-up">
       <div class="w-12 h-12 bg-rose-500/10 rounded-full flex items-center justify-center mb-4 text-rose-500 text-xl">‚ö†Ô∏è</div>
       <h3 class="text-lg font-bold text-white">Factory Reset</h3>
       <p class="text-xs text-slate-400 mb-4">This will permanently delete ALL data. Enter password to confirm.</p>
       <input id="pwInput" type="password" class="w-full bg-black/50 border border-white/10 rounded-lg p-3 text-white focus:border-rose-500 outline-none mb-6" placeholder="Password...">
       <div class="flex justify-end gap-3">
         <button id="cancelPwBtn" class="px-4 py-2 text-slate-400 hover:text-white text-sm">Cancel</button>
         <button id="confirmPwBtn" class="px-4 py-2 bg-rose-600 hover:bg-rose-500 text-white font-bold rounded-lg text-sm">NUKE IT üí•</button>
       </div>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-[#0F1115] border border-white/10 rounded-2xl shadow-2xl p-6 animate-slide-up">
       <h3 class="text-lg font-bold text-white mb-2">üì• Import Data</h3>
       <p class="text-xs text-slate-400 mb-4">Upload a CSV file generated by this app.</p>
       <div class="border-2 border-dashed border-white/10 rounded-xl p-8 text-center hover:border-blue-500/50 hover:bg-blue-500/5 transition-all cursor-pointer relative">
         <input type="file" id="importFile" accept=".csv" class="absolute inset-0 opacity-0 cursor-pointer w-full h-full">
         <div class="text-3xl mb-2">üìÑ</div>
         <span class="text-sm text-blue-400 font-medium">Click or Drag CSV Here</span>
       </div>
       <div class="flex justify-end gap-3 mt-6">
         <button id="cancelImportBtn" class="px-4 py-2 text-slate-400 hover:text-white text-sm">Cancel</button>
         <button id="confirmImportBtn" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-bold rounded-lg text-sm">Process Import</button>
       </div>
    </div>
  </div>

  <!-- JAVASCRIPT LOGIC -->
  <script>
    // --- CONFIGURATION ---
    const STORAGE_KEY = 'mrj_sales_data_v2';
    const TARGET_KEY = 'mrj_target_v2';
    const RESET_PASSWORD = 'reset'; // Simple password
    const DOLLAR_RATE = 16000;
    const SALES_COMMISSION_USD = 2.5;

    const COURSES = [
      'Coding Knight', 'Digital Literasi', 'Visual Programming',
      'Graphic Design Junior', 'Graphic Design Senior', 'Game Design',
      'Python Start', 'Python Pro', 'Math Explorers', 'Math Masters',
      'Course AI', 'Math Tutoring'
    ];

    // Helper Utils
    function uid() { return 'id-' + Date.now() + '-' + Math.random().toString(36).slice(2, 9); }
    
    function formatRp(num) {
      if (num === null || num === undefined || num === '') return 'Rp 0';
      return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(Number(num));
    }

    function showToast(title, message = '', icon = '‚úÖ') {
      const toast = document.getElementById('toast');
      document.getElementById('toastTitle').textContent = title;
      document.getElementById('toastMessage').textContent = message;
      document.getElementById('toastIcon').textContent = icon;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.remove('translate-y-10', 'opacity-0'), 10);
      setTimeout(() => {
        toast.classList.add('translate-y-10', 'opacity-0');
        setTimeout(() => toast.classList.add('hidden'), 500);
      }, 3000);
    }

    // --- DATA LAYER ---
    function loadData() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; }
    }
    function saveData(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
    function getTarget() { try { return JSON.parse(localStorage.getItem(TARGET_KEY)); } catch { return null; } }
    function saveTarget(month, val) { localStorage.setItem(TARGET_KEY, JSON.stringify({ month, val })); }

    // --- BUSINESS LOGIC ---
    function calculateStats(data, currentMonth) {
      const filtered = data.filter(r => r.monthKey === currentMonth);
      let tc = filtered.length;
      let sales = 0, revenue = 0, pending = 0;
      
      filtered.forEach(r => {
        const status = (r.buyOrNot || '').toLowerCase();
        if (status.includes('buy')) { sales++; revenue += Number(r.revenue) || 0; }
        else if (status.includes('pending')) pending++;
      });

      const conv = tc ? (sales / tc * 100) : 0;
      
      // Bonus Calculation Logic
      let bonusPct = 0;
      if (revenue <= 16830000) bonusPct = conv < 30 ? 4.5 : (conv < 40 ? 5.0 : (conv < 50 ? 6.0 : 7.0));
      else if (revenue <= 33660000) bonusPct = conv < 30 ? 5.5 : (conv < 40 ? 6.0 : (conv < 50 ? 7.0 : 8.0));
      else if (revenue <= 50490000) bonusPct = conv < 30 ? 7.0 : (conv < 40 ? 8.0 : (conv < 50 ? 9.0 : 10.5));
      else if (revenue <= 67320000) bonusPct = conv < 30 ? 8.5 : (conv < 40 ? 10.0 : (conv < 50 ? 11.5 : 13.0));
      else bonusPct = conv < 30 ? 10.5 : (conv < 40 ? 12.0 : (conv < 50 ? 13.5 : 15.0));
      
      let lvl = 'Lvl 1';
      if (revenue > 67320000) lvl = 'MAX';
      else if (revenue > 50490000) lvl = 'Lvl 4';
      else if (revenue > 33660000) lvl = 'Lvl 3';
      else if (revenue > 16830000) lvl = 'Lvl 2';

      const tcSalary = tc * SALES_COMMISSION_USD * DOLLAR_RATE;
      const bonus = revenue * (bonusPct / 100);

      // Prev Month Check
      const [y, m] = currentMonth.split('-');
      const prevKey = m === '01' ? `${parseInt(y)-1}-12` : `${y}-${String(parseInt(m)-1).padStart(2,'0')}`;
      const prevRev = data.filter(r => r.monthKey === prevKey && (r.buyOrNot||'').toLowerCase().includes('buy'))
                          .reduce((sum, r) => sum + (Number(r.revenue)||0), 0);

      return { tc, sales, pending, revenue, conv, bonus, bonusPct, lvl, tcSalary, prevRev };
    }

    // --- UI RENDERING ---
    const elements = {
      tbody: document.getElementById('tbody'),
      date: document.getElementById('date'),
      monthSelector: document.getElementById('monthSelector'),
      search: document.getElementById('searchInput'),
      statusFilter: document.getElementById('statusFilter'), // Removed from HTML but logic kept generic
      courseFilter: document.getElementById('courseFilter'),
      periodFilter: document.getElementById('periodFilter')
    };

    let selectedRows = new Set();
    let currentSort = { col: 'date', dir: 'desc' };

    function init() {
      const now = new Date();
      elements.date.valueAsDate = now;
      
      // Populate Months
      const data = loadData();
      const months = new Set(data.map(r => r.monthKey));
      months.add(`${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`);
      
      elements.monthSelector.innerHTML = '';
      Array.from(months).sort().reverse().forEach(m => {
        const opt = document.createElement('option');
        const [y, mo] = m.split('-');
        opt.value = m;
        opt.textContent = new Date(y, mo-1).toLocaleString('id-ID', { month: 'long', year: 'numeric' });
        elements.monthSelector.appendChild(opt);
      });

      // Populate Course Filter
      COURSES.forEach(c => {
        const opt = document.createElement('option'); opt.value = c; opt.textContent = c;
        elements.courseFilter.appendChild(opt);
      });

      render();
    }

    function render() {
      const data = loadData();
      const month = elements.monthSelector.value;
      const period = elements.periodFilter.value;
      const search = elements.search.value.toLowerCase();
      const courseF = elements.courseFilter.value;

      // Filter
      let filtered = data.filter(r => {
        if (r.monthKey !== month) return false;
        if (period) {
          const d = parseInt(r.date.split('-')[2]);
          if (period === 'P1' && d > 15) return false;
          if (period === 'P2' && d <= 15) return false;
        }
        if (courseF && r.course !== courseF) return false;
        if (search && !JSON.stringify(r).toLowerCase().includes(search)) return false;
        return true;
      });

      // Sort
      filtered.sort((a, b) => {
        let va = a[currentSort.col], vb = b[currentSort.col];
        if (currentSort.col === 'revenue') { va = Number(va)||0; vb = Number(vb)||0; }
        return currentSort.dir === 'asc' ? (va > vb ? 1 : -1) : (va < vb ? 1 : -1);
      });

      // Update Stats
      const stats = calculateStats(data, month);
      document.getElementById('statRevenue').textContent = formatRp(stats.revenue);
      document.getElementById('statConversion').textContent = stats.conv.toFixed(1) + '%';
      document.getElementById('statTcTotal').textContent = stats.tc;
      document.getElementById('statSales').textContent = stats.sales;
      document.getElementById('statPending').textContent = stats.pending;
      document.getElementById('statBonus').textContent = formatRp(stats.bonus);
      document.getElementById('bonusLevel').textContent = stats.lvl;
      document.getElementById('bonusPercent').textContent = stats.bonusPct.toFixed(1) + '%';
      document.getElementById('statTcSalary').textContent = formatRp(stats.tcSalary);
      
      document.getElementById('bonusBar').style.width = Math.min(stats.conv * 2, 100) + '%'; // Visual bar approx

      const diff = stats.revenue - stats.prevRev;
      const diffEl = document.getElementById('statRevChange');
      diffEl.innerHTML = diff >= 0 ? `‚ñ≤ ${formatRp(diff)} vs prev` : `‚ñº ${formatRp(Math.abs(diff))} vs prev`;
      diffEl.className = diff >= 0 ? "text-[10px] font-medium px-1.5 py-0.5 rounded bg-emerald-500/10 text-emerald-400" : "text-[10px] font-medium px-1.5 py-0.5 rounded bg-rose-500/10 text-rose-400";

      // Update Target
      const target = getTarget();
      const targetSec = document.getElementById('targetSection');
      if (target && target.month === month) {
        targetSec.classList.remove('hidden');
        const tVal = Number(target.val);
        const pct = Math.min((stats.revenue / tVal) * 100, 100);
        document.getElementById('targetDesc').textContent = formatRp(tVal);
        document.getElementById('targetCurrent').textContent = formatRp(stats.revenue);
        document.getElementById('targetPercent').textContent = pct.toFixed(1) + '%';
        document.getElementById('targetProgress').style.width = pct + '%';
        document.getElementById('targetRemaining').textContent = formatRp(Math.max(tVal - stats.revenue, 0));
      } else {
        targetSec.classList.add('hidden');
      }

      // Render Table
      elements.tbody.innerHTML = '';
      document.getElementById('recordCount').textContent = `${filtered.length} records`;
      document.getElementById('selectedMonth').textContent = elements.monthSelector.options[elements.monthSelector.selectedIndex]?.text;
      
      if (filtered.length === 0) {
        document.getElementById('emptyState').classList.remove('hidden');
      } else {
        document.getElementById('emptyState').classList.add('hidden');
        filtered.forEach(r => {
          const tr = document.createElement('tr');
          tr.className = "table-row-hover group border-b border-white/5 transition-all duration-200";
          
          let statusBadge = '';
          if (r.buyOrNot === 'Buy') statusBadge = '<span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">‚úÖ BUY</span>';
          else if (r.buyOrNot === 'Not') statusBadge = '<span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-rose-500/10 text-rose-400 border border-rose-500/20">‚ùå NOT</span>';
          else statusBadge = '<span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-amber-500/10 text-amber-400 border border-amber-500/20">‚è≥ WAIT</span>';

          tr.innerHTML = `
            <td class="p-4"><input type="checkbox" class="row-cb rounded bg-transparent border-slate-600 text-amber-500 focus:ring-0 cursor-pointer" data-id="${r.id}" ${selectedRows.has(r.id)?'checked':''}></td>
            <td class="p-4 whitespace-nowrap">
              <div class="font-mono text-xs text-white font-bold">${r.date}</div>
              <div class="text-[10px] text-slate-500">${r.time || ''}</div>
            </td>
            <td class="p-4">
              <div class="font-medium text-white text-xs">${r.childName || '-'}</div>
              ${r.crm ? `<a href="${r.crm}" target="_blank" class="text-[10px] text-blue-400 hover:underline">Link CRM ‚Üó</a>` : ''}
            </td>
            <td class="p-4 text-xs text-slate-400">${r.course}</td>
            <td class="p-4">${statusBadge}</td>
            <td class="p-4 font-mono text-xs font-bold ${r.buyOrNot === 'Buy' ? 'text-emerald-400' : 'text-slate-600'}">${formatRp(r.revenue)}</td>
            
            <!-- NOTE COLUMN (New) -->
            <td class="p-4 max-w-[180px]">
               ${r.note ? `<div class="line-clamp-2 text-[11px] text-slate-400 leading-tight cursor-help transition-colors hover:text-white" title="${r.note}">${r.note}</div>` : '<span class="text-slate-700 text-[10px]">-</span>'}
            </td>

            <td class="p-4 text-right">
              <div class="flex justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                <button onclick="editRecord('${r.id}')" class="p-1.5 hover:bg-blue-500/20 text-blue-400 rounded transition-colors">‚úèÔ∏è</button>
                <button onclick="deleteRecord('${r.id}')" class="p-1.5 hover:bg-rose-500/20 text-rose-400 rounded transition-colors">üóëÔ∏è</button>
              </div>
            </td>
          `;
          elements.tbody.appendChild(tr);
        });
      }

      // Re-attach listeners
      document.querySelectorAll('.row-cb').forEach(cb => cb.addEventListener('change', e => {
        e.target.checked ? selectedRows.add(e.target.dataset.id) : selectedRows.delete(e.target.dataset.id);
        updateBulkBtn();
      }));
    }

    function updateBulkBtn() {
      const btn = document.getElementById('bulkDeleteBtn');
      if (selectedRows.size > 0) {
        btn.style.display = 'flex';
        document.getElementById('selectedCount').textContent = selectedRows.size;
      } else btn.style.display = 'none';
    }

    // --- CRUD ---
    document.getElementById('entryForm').addEventListener('submit', e => {
      e.preventDefault();
      const id = document.getElementById('editingId').value || uid();
      const date = document.getElementById('date').value;
      
      const entry = {
        id,
        date,
        time: document.getElementById('time').value,
        childName: document.getElementById('childName').value,
        crm: document.getElementById('crm').value,
        course: document.getElementById('course').value,
        buyOrNot: document.getElementById('buyOrNot').value,
        revenue: document.getElementById('revenue').value,
        layer: document.getElementById('layer').value,
        note: document.getElementById('note').value,
        monthKey: date.slice(0, 7)
      };

      const data = loadData();
      const idx = data.findIndex(r => r.id === id);
      if (idx >= 0) data[idx] = entry; else data.push(entry);
      
      saveData(data);
      clearForm();
      init(); // Re-render & refresh months
      showToast('Success', 'Record saved successfully');
    });

    window.editRecord = (id) => {
      const r = loadData().find(d => d.id === id);
      if (!r) return;
      document.getElementById('editingId').value = r.id;
      document.getElementById('date').value = r.date;
      document.getElementById('time').value = r.time;
      document.getElementById('childName').value = r.childName;
      document.getElementById('crm').value = r.crm;
      document.getElementById('course').value = r.course;
      document.getElementById('buyOrNot').value = r.buyOrNot;
      document.getElementById('revenue').value = r.revenue;
      document.getElementById('layer').value = r.layer;
      document.getElementById('note').value = r.note;
      
      document.getElementById('formTitle').innerHTML = `<span class="text-blue-400">‚úèÔ∏è</span> Edit Record`;
      document.getElementById('duplicateBtn').classList.remove('hidden');
      document.getElementById('duplicateBtn').onclick = () => {
        saveData([...loadData(), { ...r, id: uid() }]);
        init(); showToast('Duplicated');
      };
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.deleteRecord = (id) => {
      if (confirm('Delete this record?')) {
        saveData(loadData().filter(r => r.id !== id));
        render(); showToast('Deleted', '', 'üóëÔ∏è');
      }
    };

    function clearForm() {
      document.getElementById('entryForm').reset();
      document.getElementById('editingId').value = '';
      document.getElementById('date').valueAsDate = new Date();
      document.getElementById('formTitle').textContent = 'New Record';
      document.getElementById('duplicateBtn').classList.add('hidden');
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', init);
    
    // Filters
    ['monthSelector', 'periodFilter', 'courseFilter', 'searchInput'].forEach(id => {
      document.getElementById(id).addEventListener(id === 'searchInput' ? 'input' : 'change', render);
    });

    document.getElementById('refreshBtn').addEventListener('click', () => { render(); showToast('Refreshed'); });
    document.getElementById('clearFormBtn').addEventListener('click', clearForm);
    
    // Menu
    const menuBtn = document.getElementById('menuBtn');
    const menu = document.getElementById('menu');
    menuBtn.addEventListener('click', (e) => { e.stopPropagation(); menu.classList.toggle('hidden'); });
    document.addEventListener('click', e => { if (!menu.contains(e.target)) menu.classList.add('hidden'); });

    // Modals
    const toggleModal = (id, show) => {
      const m = document.getElementById(id);
      const bg = document.getElementById('modalBackdrop');
      if (show) { m.classList.remove('hidden'); bg.classList.remove('hidden'); }
      else { m.classList.add('hidden'); bg.classList.add('hidden'); }
    };

    document.getElementById('targetBtn').addEventListener('click', () => {
      toggleModal('targetModal', true);
      const t = getTarget();
      document.getElementById('targetInput').value = t ? t.val : '';
    });
    document.getElementById('saveTargetBtn').addEventListener('click', () => {
      saveTarget(elements.monthSelector.value, document.getElementById('targetInput').value);
      toggleModal('targetModal', false);
      render();
    });
    document.getElementById('cancelTargetBtn').addEventListener('click', () => toggleModal('targetModal', false));

    document.getElementById('chartBtn').addEventListener('click', () => {
      toggleModal('chartModal', true);
      const data = loadData();
      // Simple Chart Vis using HTML/CSS Bars
      const counts = { Buy:0, Not:0, Pending:0 };
      data.forEach(r => { if(counts[r.buyOrNot]!==undefined) counts[r.buyOrNot]++; });
      const total = data.length || 1;
      
      document.getElementById('statusChart').innerHTML = `
        <div class="w-1/3 bg-emerald-500/20 h-[${(counts.Buy/total)*100}%] min-h-[20px] rounded-t relative group"><span class="absolute -top-5 w-full text-center text-xs text-emerald-400 font-bold">${counts.Buy}</span><div class="absolute bottom-2 w-full text-center text-[10px]">Buy</div></div>
        <div class="w-1/3 bg-rose-500/20 h-[${(counts.Not/total)*100}%] min-h-[20px] rounded-t relative group"><span class="absolute -top-5 w-full text-center text-xs text-rose-400 font-bold">${counts.Not}</span><div class="absolute bottom-2 w-full text-center text-[10px]">Not</div></div>
        <div class="w-1/3 bg-amber-500/20 h-[${(counts.Pending/total)*100}%] min-h-[20px] rounded-t relative group"><span class="absolute -top-5 w-full text-center text-xs text-amber-400 font-bold">${counts.Pending}</span><div class="absolute bottom-2 w-full text-center text-[10px]">Wait</div></div>
      `;
    });
    document.getElementById('closeChartBtn').addEventListener('click', () => toggleModal('chartModal', false));

    document.getElementById('resetBtn').addEventListener('click', () => toggleModal('pwModal', true));
    document.getElementById('cancelPwBtn').addEventListener('click', () => toggleModal('pwModal', false));
    document.getElementById('confirmPwBtn').addEventListener('click', () => {
      if (document.getElementById('pwInput').value === RESET_PASSWORD) {
        localStorage.clear();
        location.reload();
      } else showToast('Error', 'Wrong Password', '‚õî');
    });

    // Bulk Delete
    document.getElementById('selectAll').addEventListener('change', e => {
      document.querySelectorAll('.row-cb').forEach(cb => {
        cb.checked = e.target.checked;
        e.target.checked ? selectedRows.add(cb.dataset.id) : selectedRows.delete(cb.dataset.id);
      });
      updateBulkBtn();
    });
    
    document.getElementById('bulkDeleteBtn').addEventListener('click', () => {
      if (confirm(`Delete ${selectedRows.size} items?`)) {
        const newData = loadData().filter(r => !selectedRows.has(r.id));
        saveData(newData);
        selectedRows.clear();
        document.getElementById('selectAll').checked = false;
        render();
      }
    });

    // CSV Export/Import
    document.getElementById('exportAllBtn').addEventListener('click', () => {
      const data = loadData();
      if (!data.length) return showToast('Empty', 'No data to export');
      const headers = Object.keys(data[0]).join(',');
      const rows = data.map(r => Object.values(r).map(v => `"${String(v).replace(/"/g,'""')}"`).join(','));
      const blob = new Blob([headers + '\n' + rows.join('\n')], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'MiRaj_Backup.csv';
      a.click();
    });

    document.getElementById('importBtn').addEventListener('click', () => toggleModal('importModal', true));
    document.getElementById('cancelImportBtn').addEventListener('click', () => toggleModal('importModal', false));
    document.getElementById('confirmImportBtn').addEventListener('click', () => {
       const file = document.getElementById('importFile').files[0];
       if (!file) return;
       const reader = new FileReader();
       reader.onload = e => {
         const lines = e.target.result.split('\n');
         const headers = lines[0].split(',').map(h => h.trim());
         const newData = [];
         for (let i=1; i<lines.length; i++) {
           if (!lines[i].trim()) continue;
           const vals = lines[i].match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g).map(v => v.replace(/^"|"$/g,'').replace(/""/g,'"'));
           const obj = {};
           headers.forEach((h, idx) => obj[h] = vals[idx] || '');
           if(obj.id) newData.push(obj);
         }
         saveData([...loadData(), ...newData]);
         toggleModal('importModal', false);
         render();
         showToast('Imported', `${newData.length} records loaded`);
       };
       reader.readAsText(file);
    });
  </script>
</body>
</html>
```
